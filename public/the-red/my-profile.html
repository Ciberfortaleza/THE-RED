<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE RED - Mi Perfil | Gestiona tu Cuenta</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Gestiona tu perfil en THE RED. Edita tu información personal, sube fotos, configura tu privacidad y ve tus publicaciones en la red social más innovadora.">
    <meta name="keywords" content="THE RED, mi perfil, configuración, cuenta, editar perfil, red social, privacidad">
    <meta name="author" content="THE RED Team">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="THE RED - Mi Perfil | Gestiona tu Cuenta">
    <meta property="og:description" content="Gestiona tu perfil personal en THE RED. Edita información, configura privacidad y administra tus publicaciones.">
    <meta property="og:type" content="profile">
    <meta property="og:url" content="https://the-red-loggin.web.app/the-red/my-profile.html">
    <meta property="og:image" content="https://the-red-loggin.web.app/logo.png">
    <meta property="og:site_name" content="THE RED">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="THE RED - Mi Perfil">
    <meta name="twitter:description" content="Gestiona tu perfil personal en THE RED.">
    <meta name="twitter:image" content="https://the-red-loggin.web.app/logo.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../logo.png">
    <link rel="apple-touch-icon" href="../logo.png">
    <!-- Font Awesome para íconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Fuentes de Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

    <style>
        /* CSS Común (de common.css) */
        /* Variables CSS */
        :root {
            --dark-purple: #1e0525;
            --medium-purple: #4a1a55;
            
            --dark-red: #a0001a;
            --medium-red: #e01030;
            --light-red: #ff3058;
            
            --glow-red: 0 0 20px rgba(255, 48, 88, 0.9);
            --shadow: 0 8px 30px rgba(0, 0, 0, 0.6);
            --side-menu-width: 280px;
            --gray-dark: #1f2937;
            --gray-medium: #9ca3af;
            --gray-light: #d1d5db;
            --gray-700: #374151;
            --gray-600: #4b5563;
            --white: #fff;
            --red-primary: #dc2626;
            --gradient-purple-dark: linear-gradient(135deg, #1e0525, #4a1a55);
            --gradient-red-light: linear-gradient(45deg, #ff3058, #e01030);

            /* Variables de color de perfil predeterminadas (se pueden sobrescribir con JS) */
            --primary-text-color: var(--light-red);
            --secondary-text-color: var(--light-purple);
            --card-background-color: rgba(74, 26, 85, 0.4);
            --border-color: var(--light-red);
        }

        /* Reset y estilos base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        /* Asegurar que el HTML no tenga desbordamiento horizontal */
        html {
            overflow-x: hidden;
        }

        body {
            background-image: url('background.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            overflow-y: auto;
            position: relative;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            min-height: 10vh;
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            padding-bottom: 70px; /* Espacio para el footer fijo */
        }

        /* Estilos para los "blobs" de fondo */
        .blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.6;
            animation: blob-move 20s infinite alternate ease-in-out, blob-pulse 12s infinite alternate;
        }

        .blob-purple {
            background: radial-gradient(circle, var(--light-purple), var(--medium-purple));
            width: 450px;
            height: 450px;
            top: 10%;
            left: -15%;
            animation-delay: 0s;
        }

        .blob-red {
            background: radial-gradient(circle, var(--light-red), var(--medium-red));
            width: 550px;
            height: 550px;
            bottom: -5%;
            right: -20%;
            animation-delay: 4s;
        }

        

        
        

        @keyframes blob-pulse {
            0% { transform: scale(1); opacity: 0.6; }
            50% { transform: scale(1.08); opacity: 0.7; }
            100% { transform: scale(1); opacity: 0.6; }
        }

        @keyframes blob-move {
            0% { transform: translate(0, 0); }
            25% { transform: translate(30px, -40px); }
            50% { transform: translate(-20px, 50px); }
            75% { transform: translate(40px, -30px); }
            100% { transform: translate(0, 0); }
        }

        /* --- Cabecera Principal --- */
        .main-header {
            display: flex;
            justify-content: flex-end; /* MODIFICADO para alinear los íconos a la derecha */
            align-items: center;
            padding: 15px 20px;
            background: rgba(30, 5, 37, 0.7); /* Efecto de cristal líquido */
            backdrop-filter: blur(10px); /* Efecto de cristal líquido */
            -webkit-backdrop-filter: blur(10px); /* Efecto de cristal líquido */
            border-bottom: 1px solid rgba(125, 52, 144, 0.7); /* Efecto de cristal líquido */
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .new-post-button {
            background: var(--gradient-red-light);
            color: #fff;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--glow-red);
            position: relative;
            overflow: hidden;
        }

        .new-post-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.2);
            transition: left 0.4s ease-in-out;
            transform: skewX(-20deg);
        }

        .new-post-button:hover::before {
            left: 100%;
        }

        .new-post-button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 0 25px rgba(255, 48, 88, 1);
        }

        /* Añadido para ocultar el botón de nueva publicación en páginas específicas */
        .new-post-button.hidden-on-profile {
            display: none;
        }

        .right-icons {
            display: flex;
            gap: 18px;
        }

        .icon-button {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
            transition: color 0.3s ease, transform 0.2s ease, text-shadow 0.3s ease;
            padding: 8px;
            border-radius: 8px;
        }

        .icon-button:hover {
            color: var(--light-red);
            transform: scale(1.15);
            text-shadow: 0 0 10px var(--light-red);
        }

        /* --- Contenido Principal --- */
        .main-content {
            flex-grow: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 30px;
            position: relative;
        }

        .page-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 30px;
            opacity: 1;
            visibility: visible;
            height: auto;
            transition: opacity 0.4s ease-in-out, visibility 0.4s ease-in-out, height 0.4s ease-in-out;
        }

        .page-section.hidden {
            opacity: 0;
            visibility: hidden;
            height: 0;
            overflow: hidden;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            pointer-events: none;
        }

        /* Estilos de Entrada y Botón de Búsqueda (usado ahora en Discover) */
        .search-input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            width: 100%;
            max-width: 650px;
            margin: 15px auto 0;
            background-color: rgba(30, 5, 37, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.4), var(--shadow);
            border: 1px solid rgba(74, 26, 85, 0.6);
            align-items: center;
            justify-content: center;
        }

        .search-input-group input[type="text"] {
            flex-grow: 1;
            background-color: rgba(51, 20, 64, 0.8);
            border: 1px solid rgba(74, 26, 85, 0.6);
            border-radius: 25px;
            padding: 12px 20px;
            color: #fff;
            font-size: 1em;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.3);
            min-width: 180px;
            transition: all 0.3s ease;
        }

        .search-input-group input[type="text"]::placeholder {
            color: #bbb;
        }

        .search-input-group input[type="text"]:focus {
            outline: none;
            border-color: var(--light-red);
            box-shadow: 0 0 8px rgba(255, 48, 88, 0.6), inset 0 0 8px rgba(255, 48, 88, 0.4);
        }

        .search-input-group button {
            background: var(--gradient-red-light);
            color: #fff;
            border: none;
            border-radius: 25px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            white-space: nowrap;
        }

        .search-input-group button:hover {
            background-color: var(--medium-red);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 48, 88, 0.9);
        }

        /* --- Pie de Página (main-footer) --- */
        .main-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(30, 5, 37, 0.8);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-top: 1px solid rgba(74, 26, 85, 0.6);
            box-shadow: 0 -6px 25px rgba(0, 0, 0, 0.5);
            padding: 18px 0;
            z-index: 1000;
        }

        .footer-nav {
            display: flex;
            justify-content: space-around;
            max-width: 900px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #ccc;
            font-size: 1em;
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-red-light);
            transform: scaleX(0);
            transform-origin: bottom right;
            transition: transform 0.3s ease-out;
            z-index: -1;
            border-radius: 10px;
        }

        .nav-item.active::before,
        .nav-item:hover::before {
            transform: scaleX(1);
            transform-origin: bottom left;
        }

        .nav-item.active,
        .nav-item:hover {
            color: #fff;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.7);
        }

        .nav-item.active i,
        .nav-item:hover i {
            color: #fff;
        }

        /* --- Botón de Chat Flotante --- */
        .floating-chat-button {
            position: fixed;
            bottom: 90px;
            right: 25px;
            background: var(--gradient-red-light);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 65px;
            height: 65px;
            font-size: 2em;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: var(--glow-red), var(--shadow);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .floating-chat-button:hover {
            background-color: var(--light-red);
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 0 30px rgba(255, 48, 88, 1);
        }

        /* --- Modales (Popups) Generales --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Z-index para modales */
            backdrop-filter: blur(10px);
            transition: background-color 0.3s ease;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal-content {
            background-color: rgba(30, 5, 37, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            padding: 35px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            max-width: 550px;
            width: 90%;
            border: 1px solid rgba(125, 52, 144, 0.7);
            position: relative;
            animation: fadeInScale 0.4s ease-out forwards;
        }

        .modal-content h2 {
            color: var(--light-red);
            margin-bottom: 25px;
            font-size: 2em;
            text-shadow: 0 0 10px rgba(255, 48, 88, 0.7);
        }

        .modal-content p.modal-message {
            margin-bottom: 25px;
            color: #e8e8e8;
            font-size: 1.1em;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            justify-content: center;
            /* Solo un botón, no se necesita espacio, solo centrarlo */
            /* gap: 25px; */
            margin-top: 25px;
        }

        .modal-button {
            background: var(--gradient-red-light);
            color: #fff;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1.05em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        .modal-button:hover {
            background-color: var(--medium-red);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(255, 48, 88, 0.8);
        }

        /* Animaciones */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.85);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        .animate-fade-in-up {
            animation: fadeInScale 0.4s ease-out forwards;
        }

        /* Indicador de carga */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: #fff;
            font-size: 1.3em;
        }

        .loading-overlay.hidden {
            display: none;
        }

        .spinner {
            border: 10px solid rgba(255, 255, 255, 0.4);
            border-top: 10px solid var(--light-red);
            border-radius: 50%;
            width: 70px;
            height: 70px;
            animation: spin 0.8s linear infinite;
            margin-bottom: 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- Menú Lateral Izquierdo (para el botón "Menú") --- */
        .side-menu-left {
            position: fixed;
            top: 0;
            left: 0;
            width: var(--side-menu-width);
            height: 100%;
            background-color: rgba(30, 5, 37, 0.9);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: 8px 0 30px rgba(0, 0, 0, 0.6);
            z-index: 1500; /* Z-index para menús laterales */
            display: flex;
            flex-direction: column;
            padding-top: 25px;
            border-right: 1px solid rgba(125, 52, 144, 0.7);

            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease-in-out;
            transform: translateX(-100%);
        }

        .side-menu-left.open {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }

        /* Estilos para el área de contenido dentro del menú lateral */
        .side-menu-content-display {
            flex-grow: 1;
            overflow-y: auto;
            padding: 0 25px 25px 25px;
            color: #e0e0e0;
            line-height: 1.6;
            text-align: left;
            display: flex; /* Usar flex para apilar contenido y botón de retroceso */
            flex-direction: column;
        }

        .side-menu-content-display h3 {
            font-size: 1.6em;
            color: var(--light-red);
            margin-bottom: 15px;
            text-shadow: 0 0 8px rgba(255, 48, 88, 0.5);
        }

        .side-menu-content-display h4 {
            font-size: 1.3em;
            color: var(--light-purple);
            margin-top: 20px;
            margin-bottom: 10px;
        }

        .side-menu-content-display p,
        .side-menu-content-display ul,
        .side-menu-content-display ol {
            margin-bottom: 15px;
        }

        .side-menu-content-display ul,
        .side-menu-content-display ol {
            padding-left: 20px;
        }

        .side-menu-content-display li {
            margin-bottom: 8px;
        }

        .side-menu-content-display .back-button {
            background: var(--gradient-red-light);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            margin-top: auto; /* Empujar hacia abajo */
            width: 100%;
            align-self: center; /* Centrar el botón */
        }

        .side-menu-content-display .back-button:hover {
            background-color: var(--medium-red);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(255, 48, 88, 0.9);
        }

        /* --- Menú Lateral Derecho (para el botón "Recompensas") --- */
        .side-menu-right {
            position: fixed;
            top: 0;
            right: 0;
            width: var(--side-menu-width);
            height: 100%;
            background-color: rgba(30, 5, 37, 0.9);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            box-shadow: -8px 0 30px rgba(0, 0, 0, 0.6);
            z-index: 1500; /* Z-index para menús laterales */
            display: flex;
            flex-direction: column;
            padding-top: 25px;
            border-left: 1px solid rgba(125, 52, 144, 0.7);

            opacity: 0;
            visibility: hidden;
            transition: all 0.4s ease-in-out;
            transform: translateX(100%);
        }

        .side-menu-right.open {
            opacity: 1;
            visibility: visible;
            transform: translateX(0);
        }

        /* --- Modal de Información --- */
        .info-modal-content {
            background-color: rgba(30, 5, 37, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            border: 1px solid rgba(125, 52, 144, 0.7);
            position: relative;
            animation: fadeInScale 0.4s ease-out forwards;
        }

        .info-modal-content .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #fff;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .info-modal-content .close-button:hover {
            color: var(--medium-red);
            transform: scale(1.1) rotate(90deg);
        }

        .info-modal-content h2 {
            color: var(--light-red);
            margin-bottom: 20px;
            font-size: 2.2em;
            text-shadow: 0 0 10px rgba(255, 48, 88, 0.7);
            text-align: center;
        }

        .modal-intro-text {
            color: #e8e8e8;
            font-size: 1.2em;
            line-height: 1.6;
            margin-bottom: 25px;
            text-align: center;
            font-style: italic;
        }

        .modal-body-content {
            color: #e0e0e0;
            line-height: 1.6;
            text-align: left;
        }

        .modal-body-content h3 {
            color: var(--light-red);
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.6em;
            text-shadow: 0 0 8px rgba(255, 48, 88, 0.5);
        }

        .modal-body-content h4 {
            color: var(--light-purple);
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .modal-body-content ul, .modal-body-content ol {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .modal-body-content li {
            margin-bottom: 8px;
        }

        .modal-body-content p {
            margin-bottom: 15px;
        }

        .price-plan-card {
            background-color: rgba(74, 26, 85, 0.6);
            border: 1px solid rgba(125, 52, 144, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: center;
            transition: all 0.3s ease;
        }

        .price-plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(125, 52, 144, 0.5);
            border-color: var(--light-purple);
        }

        .price-plan-card h3 {
            color: var(--light-purple);
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .price-plan-card .price {
            color: var(--light-red);
            font-size: 2.5em;
            font-weight: 800;
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 48, 88, 0.7);
        }

        .price-plan-card .price small {
            font-size: 0.6em;
            color: #ccc;
        }

        .price-plan-card ul {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }

        .price-plan-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(125, 52, 144, 0.3);
        }

        .price-plan-card li:last-child {
            border-bottom: none;
        }

        .price-plan-card li i {
            color: var(--light-red);
            margin-right: 10px;
        }

        .subscribe-button {
            background: var(--gradient-red-light);
            color: #fff;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            width: 100%;
            margin-top: 15px;
        }

        .subscribe-button:hover {
            background-color: var(--medium-red);
            transform: translateY(-3px);
            box-shadow: 0 0 20px rgba(255, 48, 88, 0.9);
        }

        .side-menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 25px 25px 25px;
            border-bottom: 1px solid rgba(125, 52, 144, 0.7);
            margin-bottom: 25px;
        }

        .side-menu-title {
            font-size: 1.8em;
            font-weight: 800;
            color: var(--light-red);
            text-shadow: 0 0 10px rgba(255, 48, 88, 0.7);
        }

        .side-menu-close-btn {
            background: none;
            border: none;
            color: #fff;
            font-size: 2.5em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .side-menu-close-btn:hover {
            color: var(--medium-red);
            transform: scale(1.1) rotate(90deg);
        }

        .side-menu-nav {
            display: flex;
            flex-direction: column;
            gap: 12px;
            flex-grow: 1;
            overflow-y: auto;
        }

        .side-menu-item {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            text-decoration: none;
            color: #e0e0e0;
            font-size: 1.15em;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .side-menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(125, 52, 144, 0.2);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.3s ease-out;
            z-index: -1;
        }

        .side-menu-item:hover::before {
            transform: scaleX(1);
        }

        .side-menu-item:hover {
            color: #fff;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }

        .side-menu-item:hover i {
            color: var(--light-red);
        }

        /* Estilos para las tarjetas de perfil (profile-card) */
        .profile-card {
            background-color: rgba(74, 26, 85, 0.4);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(125, 52, 144, 0.6);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5), 0 0 20px rgba(125, 52, 144, 0.5);

            min-width: 320px;
            max-width: 350px;
            width: 100%;
            flex-shrink: 0;
            border-radius: 20px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 15px;
            filter: brightness(0.95);
            transition: all 0.3s ease;
        }

        .profile-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8), var(--glow-red);
            border-color: var(--light-red);
            background-color: rgba(74, 26, 85, 0.6);
            filter: brightness(1.2);
        }

        .profile-card .profile-avatar {
            width: 110px;
            height: 110px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--light-red);
            box-shadow: 0 0 15px rgba(255, 48, 88, 0.8);
            margin-bottom: 15px;
        }

        .profile-card .profile-username {
            font-size: 1.4em;
            font-weight: 800;
            color: var(--light-red);
            text-shadow: 0 0 8px rgba(255, 48, 88, 0.6);
        }

        .profile-card .profile-bio {
            font-size: 1em;
            color: #e8e8e8;
            line-height: 1.5;
            margin-bottom: 15px;
            text-align: left;
            width: 100%;
        }

        /* Estilos para el carrusel de imágenes del perfil */
        .profile-image-carousel {
            position: relative;
            width: 100%;
            height: 150px;
            overflow: hidden;
            border-radius: 10px;
            margin-bottom: 15px;
            background-color: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(125, 52, 144, 0.6);
        }

        .profile-image-carousel-container {
            display: flex;
            height: 100%;
            transition: transform 0.5s ease-in-out;
        }

        .profile-carousel-image {
            min-width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .profile-carousel-navigation {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
            padding: 0 5px;
            z-index: 10;
        }

        .profile-carousel-arrow {
            background-color: rgba(255, 48, 88, 0.7);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            font-size: 1em;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .profile-carousel-arrow:hover {
            background-color: var(--red-primary);
            transform: scale(1.1);
        }

        /* Estilos para las tags del perfil */
        .profile-tags-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            margin-bottom: 15px;
            width: 100%;
        }

        .profile-tag {
            background-color: rgba(125, 52, 144, 0.6);
            color: #fff;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(125, 52, 144, 0.8);
            white-space: nowrap;
        }

        .profile-tag:hover {
            background-color: var(--light-purple);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 2px 10px rgba(125, 52, 144, 0.9);
        }


        .profile-card .profile-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 15px;
            color: var(--light-purple);
            font-size: 0.95em;
            font-weight: 600;
        }

        .profile-card .profile-stats i {
            margin-right: 8px;
            color: var(--primary-text-color);
            font-size: 1.1em;
        }

        .profile-card .profile-action-button {
            background: var(--gradient-red-light);
            color: #fff;
            border: none;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }

        .profile-card .profile-action-button:hover {
            background-color: var(--medium-red);
            transform: translateY(-3px);
            box-shadow: 0 0 15px rgba(255, 48, 88, 0.9);
        }

        /* --- Nueva Tarjeta de Texto Largo (Long Text Card) --- */
        .long-text-card {
            background-color: rgba(74, 26, 85, 0.4);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(125, 52, 144, 0.6);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5), 0 0 20px rgba(125, 52, 144, 0.5);
            border-radius: 20px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            filter: brightness(0.95);
            transition: all 0.3s ease;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .long-text-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8), var(--glow-purple);
            filter: brightness(1.2);
            background-color: rgba(74, 26, 85, 0.6);
            border-color: var(--light-purple);
        }

        .long-text-card.sponsored-post {
            border: 2px solid rgba(255, 48, 88, 0.8);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.5), 0 0 20px rgba(255, 48, 88, 0.5);
        }

        .long-text-card.sponsored-post:hover {
            border-color: var(--light-red);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8), var(--glow-red);
        }

        .long-text-card .card-header-top {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
            position: relative;
            flex-wrap: wrap;
        }

        .long-text-card .card-image-wrapper {
            width: 100%;
            height: 200px;
            background-color: #000;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            border: 3px solid var(--light-red);
            box-shadow: 0 0 15px rgba(255, 48, 88, 0.7);
            cursor: pointer; /* Hacer la imagen clickeable */
        }

        .long-text-card .card-image-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .long-text-card .card-image-wrapper img:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(255, 48, 88, 0.9);
        }

        .long-text-card .card-user-info-and-avatar {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-grow: 1;
            min-width: 150px;
            margin-top: 15px;
        }

        .long-text-card .card-user-avatar {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--light-red);
            box-shadow: 0 0 10px rgba(255, 48, 88, 0.6);
            flex-shrink: 0;
        }

        .long-text-card .card-user-details {
            display: flex;
            flex-direction: column;
            text-align: left;
        }

        .long-text-card .card-username {
            font-weight: 800;
            color: var(--light-red);
            font-size: 1.1em;
            text-shadow: 0 0 5px rgba(255, 48, 88, 0.4);
            margin: 0;
        }

        .long-text-card .card-user-handle {
            font-size: 0.9em;
            color: #ccc;
            margin: 0;
        }

        .long-text-card .card-tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            justify-content: flex-start;
        }

        .long-text-card .card-tag {
            background-color: rgba(125, 52, 144, 0.6);
            color: #fff;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(125, 52, 144, 0.8);
            white-space: nowrap;
        }

        .long-text-card .card-tag:hover {
            background-color: var(--light-purple);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 2px 10px rgba(125, 52, 144, 0.9);
        }

        .long-text-card .card-long-text {
            font-size: 1em;
            line-height: 1.6;
            color: #f0f0f0;
            text-align: left;
        }

        .long-text-card .card-actions {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-top: 15px;
            border-top: 1px solid rgba(125, 52, 144, 0.6);
            padding-top: 15px;
        }

        .long-text-card .action-button {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border-radius: 25px;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .long-text-card .action-button:hover {
            background-color: rgba(74, 26, 85, 0.6);
            color: var(--light-red);
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(255, 48, 88, 0.5);
        }


        /* Estilos generales de entrada para entradas de archivo */
        .modal-input[type="file"] {
            background-color: rgba(0,0,0,0.3);
            border: 1px solid var(--medium-purple);
            border-radius: 5px;
            padding: 10px;
            color: white;
            width: 100%;
            box-sizing: border-box; /* Incluir relleno y borde en el ancho y alto total del elemento */
        }
        .modal-input[type="file"]::file-selector-button {
            background: var(--gradient-purple-dark);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }
        .modal-input[type="file"]::file-selector-button:hover {
            background: var(--light-purple);
            transform: translateY(-1px);
        }

        /* Estilos para el diseño del modal de edición de perfil (Ajustado) */
        .profile-edit-form-section {
            display: flex;
            flex-direction: column;
            gap: 20px; /* Espacio entre grupos de formulario */
        }

        .profile-edit-form-group {
            margin-bottom: 0; /* Restablecer margen inferior predeterminado */
        }

        .profile-edit-form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--light-red);
            font-weight: 600;
        }

        .profile-edit-form-group .modal-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--medium-purple);
            background-color: rgba(0,0,0,0.4);
            color: white;
            font-size: 1em;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .profile-edit-form-group .modal-input:focus {
            outline: none;
            border-color: var(--light-red);
            box-shadow: 0 0 0 3px rgba(255, 48, 88, 0.3);
        }

        .profile-edit-form-group textarea.modal-input {
            min-height: 80px;
            resize: vertical;
        }

        .profile-edit-form-group .color-inputs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 15px;
        }

        .profile-edit-form-group .color-inputs-grid input[type="color"] {
            width: 100%;
            height: 45px;
            border-radius: 8px;
            border: 1px solid var(--medium-purple);
            background-color: rgba(0,0,0,0.4);
            cursor: pointer;
        }

        .profile-edit-form-group .checkbox-group {
            display: flex;
            align-items: center;
            margin-top: 10px;
            gap: 8px;
        }

        .profile-edit-form-group .checkbox-group input[type="checkbox"] {
            transform: scale(1.2);
            accent-color: var(--light-red);
        }

        .profile-edit-form-group .checkbox-group label {
            margin-bottom: 0;
            color: #e0e0e0;
            font-weight: 400;
        }

        /* Estilos para el nuevo modal de información genérico */
        .info-modal-content {
            background-color: rgba(30, 5, 37, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            max-width: 600px;
            width: 90%;
            border: 1px solid rgba(125, 52, 144, 0.8);
            position: relative;
            animation: fadeInScale 0.4s ease-out forwards;
            display: flex;
            flex-direction: column;
            text-align: left; /* Alinear texto a la izquierda */
            max-height: 80vh; /* Limitar altura para hacer scrollable */
        }

        .info-modal-content .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #fff;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .info-modal-content .close-button:hover {
            color: var(--medium-red);
            transform: scale(1.1) rotate(90deg);
        }

        .info-modal-content h2 {
            color: var(--light-red);
            margin-bottom: 15px;
            font-size: 2em;
            text-shadow: 0 0 10px rgba(255, 48, 88, 0.7);
            text-align: center; /* Centrar título */
        }

        .info-modal-content .modal-intro-text {
            color: var(--light-purple);
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center; /* Centrar texto de introducción */
        }

        .info-modal-content .modal-body-content {
            flex-grow: 1;
            overflow-y: auto; /* Hacer el contenido scrollable */
            padding-right: 15px; /* Espacio para la barra de desplazamiento */
            line-height: 1.6;
            color: #e0e0e0;
        }

        .info-modal-content .modal-body-content h3 {
            font-size: 1.5em;
            color: var(--light-red);
            margin-top: 20px;
            margin-bottom: 10px;
            text-shadow: 0 0 5px rgba(255, 48, 88, 0.4);
        }

        .info-modal-content .modal-body-content h4 {
            font-size: 1.2em;
            color: var(--light-purple);
            margin-top: 15px;
            margin-bottom: 8px;
        }

        .info-modal-content .modal-body-content p,
        .info-modal-content .modal-body-content ul,
        .info-modal-content .modal-body-content ol {
            margin-bottom: 15px;
        }

        .info-modal-content .modal-body-content ul,
        .info-modal-content .modal-body-content ol {
            padding-left: 25px;
        }
        .info-modal-content .modal-body-content li {
            margin-bottom: 8px;
        }

        /* Nuevos estilos para el modal de selección de idioma */
        .language-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            padding: 10px 15px;
            border-radius: 10px;
            background-color: rgba(74, 26, 85, 0.4);
            border: 1px solid rgba(125, 52, 144, 0.6);
            transition: all 0.3s ease;
        }

        .language-option:hover {
            background-color: rgba(125, 52, 144, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .language-option input[type="radio"] {
            transform: scale(1.5);
            accent-color: var(--light-red);
            margin-right: 10px;
        }

        .language-option label {
            font-size: 1.1em;
            color: #e0e0e0;
            cursor: pointer;
            flex-grow: 1;
        }

        /* Estilos para la Sección de Precios */
        .price-plan-card {
            background-color: rgba(74, 26, 85, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--light-purple);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            text-align: center;
        }

        .price-plan-card:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6), var(--glow-purple);
            border-color: var(--light-red);
        }

        .price-plan-card h3 {
            color: var(--light-red);
            font-size: 1.8em;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(255, 48, 88, 0.6);
        }

        .price-plan-card .price {
            font-size: 2.5em;
            font-weight: 800;
            color: var(--light-purple);
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(125, 52, 144, 0.6);
        }

        .price-plan-card .price small {
            font-size: 0.5em;
            font-weight: 400;
            color: #ccc;
        }

        .price-plan-card ul {
            list-style: none;
            padding: 0;
            margin-bottom: 20px;
            text-align: left;
            color: #e0e0e0;
        }

        .price-plan-card ul li {
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .price-plan-card ul li i {
            color: var(--light-red);
            margin-top: 4px;
        }

        .price-plan-card .subscribe-button {
            background: var(--gradient-red-light);
            color: #fff;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .price-plan-card .subscribe-button:hover {
            background-color: var(--medium-red);
            transform: translateY(-3px);
            box-shadow: 0 0 20px rgba(255, 48, 88, 0.8);
        }

        /* Estilos específicos del Modal de Pago */
        .payment-form-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .payment-form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--light-red);
            font-weight: 600;
        }

        .payment-form-group .modal-input {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--medium-purple);
            background-color: rgba(0,0,0,0.3);
            color: white;
            font-size: 1em;
        }

        .payment-form-group .modal-input:focus {
            outline: none;
            border-color: var(--light-red);
            box-shadow: 0 0 0 2px rgba(255, 48, 88, 0.3);
        }

        .payment-form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .payment-form-grid .payment-form-group:last-child {
            grid-column: span 2; /* Hacer que el último grupo ocupe todo el ancho */
        }

        /* Estilos del Modal de Vista Previa de Publicación */
        .post-preview-modal-content {
            background-color: rgba(30, 5, 37, 0.95);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            max-width: 700px;
            width: 90%;
            border: 1px solid rgba(125, 52, 144, 0.8);
            position: relative;
            animation: fadeInScale 0.4s ease-out forwards;
            display: flex;
            flex-direction: column;
            max-height: 90vh;
            overflow-y: auto;
        }

        .post-preview-modal-content .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #fff;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }

        .post-preview-modal-content .close-button:hover {
            color: var(--medium-red);
            transform: scale(1.1) rotate(90deg);
        }

        .post-preview-modal-content h2 {
            color: var(--light-red);
            margin-bottom: 15px;
            font-size: 2em;
            text-shadow: 0 0 10px rgba(255, 48, 88, 0.7);
            text-align: center;
        }

        .post-preview-modal-content .post-image-preview {
            width: 100%;
            max-height: 400px;
            object-fit: contain;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 3px solid var(--light-red);
            box-shadow: 0 0 15px rgba(255, 48, 88, 0.7);
        }

        .post-preview-modal-content .post-author-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(125, 52, 144, 0.6);
        }

        .post-preview-modal-content .post-author-info img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--light-red);
            box-shadow: 0 0 10px rgba(255, 48, 88, 0.6);
        }

        .post-preview-modal-content .post-author-details {
            text-align: left;
        }

        .post-preview-modal-content .post-author-details .username {
            font-weight: 800;
            color: var(--light-red);
            font-size: 1.2em;
            text-shadow: 0 0 5px rgba(255, 48, 88, 0.4);
        }

        .post-preview-modal-content .post-author-details .handle {
            font-size: 0.95em;
            color: #ccc;
        }

        .post-preview-modal-content .post-text {
            font-size: 1.1em;
            line-height: 1.6;
            color: #e0e0e0;
            text-align: left;
            margin-bottom: 20px;
        }

        .post-preview-modal-content .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .post-preview-modal-content .post-tag {
            background-color: rgba(125, 52, 144, 0.6);
            color: #fff;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid rgba(125, 52, 144, 0.8);
        }

        .post-preview-modal-content .modal-actions {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }


        /* Media Queries para Responsividad */
        @media (max-width: 768px) {
            .main-header {
                flex-wrap: wrap;
                padding: 12px 18px;
                gap: 12px;
            }

            .right-icons {
                flex-grow: 1;
                justify-content: center;
                gap: 15px;
                order: 2;
            }

            .icon-button {
                font-size: 1.3em;
                padding: 6px;
            }

            .icon-button svg {
                width: 22px;
                height: 22px;
            }

            .modal-content, .info-modal-content, .post-preview-modal-content {
                padding: 25px;
            }

            .modal-button {
                padding: 10px 20px;
                font-size: 1em;
            }

            .side-menu-header {
                padding: 0 18px 18px 18px;
            }

            .side-menu-item {
                padding: 12px 18px;
                font-size: 1.05em;
            }

            .profile-edit-form-group .color-inputs-grid {
                grid-template-columns: 1fr; /* Apilar entradas de color en pantallas pequeñas */
            }
        }

        @media (max-width: 480px) {
            .main-header {
                padding: 10px;
            }

            .icon-button {
                font-size: 1.1em;
                padding: 5px;
            }

            .icon-button svg {
                width: 22px;
                height: 22px;
            }

            .modal-content, .info-modal-content, .post-preview-modal-content {
                padding: 25px;
            }

            .modal-button {
                padding: 10px 20px;
                font-size: 1em;
            }

            .side-menu-header {
                padding: 0 18px 18px 18px;
            }

            .side-menu-item {
                padding: 12px 18px;
                font-size: 1.05em;
            }
        }

        /* CSS Específico de la Página Mi Perfil (de my-profile.css) */
        /* Estilos específicos de la página Mi Perfil */

        .profile-view-container {
            width: 100%;
            max-width: 900px;
            margin: 20px; /* MODIFICADO: No más 'auto' para centrar */
            background-color: rgba(30, 5, 37, 0.7); /* AÑADIDO: un fondo sutil para que el contenido sea legible */
            backdrop-filter: blur(10px); /* AÑADIDO: efecto cristal */
            -webkit-backdrop-filter: blur(10px); /* AÑADIDO: efecto cristal */
            border-radius: 25px;
            padding: 30px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            min-height: 500px;
        }


        .profile-view-container:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.8), var(--glow-purple);
            border-color: var(--light-purple);
        }

        .profile-edit-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--gradient-red-light);
            color: #fff;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 1.4em;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            z-index: 10;
        }

        .profile-edit-btn:hover {
            background-color: var(--medium-red);
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 0 15px rgba(255, 48, 88, 0.9);
        }

        .profile-grid-container {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            width: 100%;
            justify-content: flex-start; /* MODIFICADO: Alinear al inicio */
            align-items: flex-start;
            margin-top: 20px;
        }

        .profile-left-column {
            flex: 1;
            min-width: 280px;
            max-width: 350px;
            background-color: var(--card-background-color); /* Usar variable de color de fondo de tarjeta */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border-color); /* Usar variable de color de borde */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center; /* AÑADIDO: Centrar texto en esta columna */
            gap: 15px;
        }

        .profile-avatar-large {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid var(--border-color); /* Usar variable de color de borde */
            box-shadow: 0 0 20px rgba(255, 48, 88, 0.8);
            margin-bottom: 10px;
        }

        .profile-left-column h2 {
            font-size: 2em;
            font-weight: 800;
            color: var(--primary-text-color); /* Usar variable de color de texto primario */
            text-shadow: 0 0 10px rgba(255, 48, 88, 0.7);
            margin-bottom: 10px;
        }

        .profile-contact-section {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            width: 100%;
        }

        .profile-contact-button {
            background: var(--gradient-purple-dark);
            color: #fff;
            border: none;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-contact-button:hover {
            background-color: var(--light-purple);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(125, 52, 144, 0.8);
        }

        .profile-section-title-purple {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--secondary-text-color); /* Usar variable de color de texto secundario */
            margin-top: 25px;
            margin-bottom: 15px;
            text-shadow: 0 0 8px rgba(125, 52, 144, 0.6);
            border-bottom: 2px solid var(--secondary-text-color);
            padding-bottom: 5px;
            width: 100%;
        }

        .profile-photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            width: 100%;
            margin-top: 10px;
        }

        .profile-photo-placeholder {
            width: 100%;
            padding-bottom: 100%; /* Para mantener la relación de aspecto 1:1 */
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color); /* Usar variable de color de borde */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            cursor: pointer; /* AÑADIDO: cursor pointer */
        }

        .profile-photo-placeholder img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .profile-photo-placeholder:hover img {
            transform: scale(1.1);
        }

        .profile-right-column {
            flex: 2;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .profile-preview-section {
            background-color: var(--card-background-color); /* Usar variable de color de fondo de tarjeta */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            border: 1px solid var(--border-color); /* Usar variable de color de borde */
            text-align: left;
        }

        /* Estilos para las tarjetas de publicaciones */
        .post-card {
            background-color: var(--card-background-color);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid var(--border-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .post-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
        }

        .post-card img {
            max-width: 100%;
            border-radius: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .post-card p {
            color: #fff;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .post-date {
            color: var(--gray-medium);
            font-size: 0.9em;
            font-style: italic;
        }

        .post-tags {
            margin-top: 10px;
        }

        .post-tags .tag {
            background: var(--light-purple);
            color: #fff;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-right: 8px;
            margin-bottom: 5px;
            display: inline-block;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .no-posts-message {
            text-align: center;
            color: var(--gray-medium);
            font-style: italic;
            padding: 30px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border: 1px dashed var(--gray-medium);
        }

        .profile-preview-section h3 {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary-text-color); /* Usar variable de color de texto primario */
            margin-bottom: 15px;
            text-shadow: 0 0 8px rgba(255, 48, 88, 0.6);
        }

        .profile-preview-section p,
        .profile-preview-section ul {
            font-size: 1em;
            line-height: 1.6;
            color: var(--secondary-text-color); /* Usar variable de color de texto secundario */
        }

        .profile-preview-section ul {
            list-style: none;
            padding-left: 0;
        }

        .profile-preview-section ul li {
            margin-bottom: 8px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .profile-preview-section ul li i {
            color: var(--primary-text-color);
            margin-top: 4px;
        }

        .profile-music-links {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .profile-music-links a {
            color: var(--primary-text-color);
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s ease, transform 0.2s ease;
        }

        .profile-music-links a:hover {
            color: var(--light-red);
            transform: translateY(-2px);
        }

        .profile-music-links a i {
            font-size: 1.2em;
        }

        /* Estilos para las vistas previas de imágenes en los modales */
        .image-upload-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            border: 1px dashed rgba(125, 52, 144, 0.6);
            padding: 10px;
            border-radius: 10px;
            min-height: 50px;
            align-items: center;
            justify-content: flex-start;
            overflow-x: auto;
        }

        .image-upload-preview .preview-item {
            position: relative;
            width: 80px;
            height: 80px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid var(--light-red);
            box-shadow: 0 0 8px rgba(255, 48, 88, 0.5);
            flex-shrink: 0;
        }

        .image-upload-preview .preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .image-upload-preview .preview-item .remove-btn {
            position: absolute;
            top: 2px;
            right: 2px;
            background-color: rgba(255, 48, 88, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.8em;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .image-upload-preview .preview-item .remove-btn:hover {
            background-color: var(--dark-red);
        }

        /* Media Queries Específicas de la Página Mi Perfil */
        @media (max-width: 768px) {
            .profile-view-container {
                padding: 20px;
                margin: 10px auto;
            }

            .profile-grid-container {
                flex-direction: column;
                gap: 20px;
            }

            .profile-left-column,
            .profile-right-column {
                min-width: unset;
                max-width: 100%;
                width: 100%;
            }

            .profile-avatar-large {
                width: 120px;
                height: 120px;
            }

            .profile-left-column h2 {
                font-size: 1.8em;
            }

            .profile-section-title-purple {
                font-size: 1.3em;
            }

            .profile-preview-section h3 {
                font-size: 1.3em;
            }
        }

        @media (max-width: 480px) {
            .profile-view-container {
                padding: 15px;
            }

            .profile-edit-btn {
                width: 40px;
                height: 40px;
                font-size: 1.2em;
                top: 15px;
                right: 15px;
            }

            .profile-left-column {
                padding: 20px;
            }

            .profile-avatar-large {
                width: 100px;
                height: 100px;
            }

            .profile-left-column h2 {
                font-size: 1.6em;
            }

            .profile-contact-button {
                padding: 8px 12px;
                font-size: 0.8em;
            }

            .profile-photo-grid {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            }

            .profile-preview-section {
                padding: 20px;
            }

            .profile-preview-section p,
            .profile-preview-section ul {
                font-size: 0.9em;
            }
        }

        /* --- NUEVOS ESTILOS PARA LA SECCIÓN DE PUBLICACIONES --- */
        #myPostsSectionContainer .post-card {
            background-color: var(--card-background-color);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            text-align: left;
        }
        #myPostsSectionContainer .post-card img {
            max-width: 100%;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        #myPostsSectionContainer .post-card p {
            color: var(--secondary-text-color);
            line-height: 1.6;
        }
        #myPostsSectionContainer .post-card .post-date {
            font-size: 0.8em;
            color: #aaa;
            margin-top: 15px;
            display: block;
        }
        #myPostsSectionContainer .no-posts-message {
            color: var(--secondary-text-color);
            text-align: center;
            padding: 20px;
        }

    </style>
</head>
<body>
    <div class="app-container">
        <!-- Fondo de galaxia simulado con gradientes y pseudoelementos -->
        <div class="background-elements">
            <div class="blob blob-purple"></div>
            <div class="blob blob-red"></div>
            <div class="blob blob-blue"></div>
            <div class="blob blob-green"></div>
            <div class="blob blob-yellow"></div>
        </div>

        <!-- Cabecera -->
        <header class="main-header">
            <div class="right-icons">
                <button class="icon-button" id="settingsButton" title="Cambiar idioma, país, moneda">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-globe">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20" />
                        <path d="M2 12h20" />
                    </svg>
                </button>

                <button class="icon-button" id="mapButton" title="Acceder al mapa">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucude-layers">
                        <path d="m12.83 2.112 7.74 3.084a.5.5 0 0 1 .43.43L22 10.16c.07.78-.346 1.487-.999 1.767l-7.227 3.003c-.482.2-.84-.047-.84-.047l-6.825-3.007c-.482-.2-.84-.047-.84-.047L2 7.026c-.07-.78.346-1.487.999-1.767l7.227-3.003c.482-.2.84.047.84.047Z"/>
                        <path d="M2.527 10.297c-.07.78.346 1.487-.999 1.767l-7.227 3.003c-.482-.2-.84-.047-.84-.047L-4 7.026c-.07-.78-.346-1.487-.999-1.767L-13.227 2.256c-.482-.2-.84.047-.84.047Z"/>
                        <path d="M12 16.5l-7.227-3.003c-.482-.2-.84-.047-.84-.047L2.527 10.297c-.07.78.346 1.487-.999 1.767l7.227 3.003c-.482-.2-.84.047-.84.047L21 7.026c.07-.78-.346-1.487-.999-1.767L12.774 2.256c-.482-.2-.84.047-.84.047Z"/>
                    </svg>
                </button>

                <button class="icon-button" id="profileButton" title="Configuración del perfil">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-user">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                        <circle cx="12" cy="7" r="4" />
                    </svg>
                </button>
            </div>
        </header>

        <!-- Contenido principal -->
        <main class="main-content">
            <!-- Contenido de la Página Mi Perfil -->
            <section id="my-profile-page-content" class="page-section">
                <h1 class="discover-section-header" style="text-align: left; width: 100%; max-width: 900px; margin: 0 20px;">
                    <span class="section-title">Mi Perfil</span>
                </h1>

                <div id="profilePreviewView" class="profile-view-container">
                    <!-- Botón de edición de perfil -->
                    <button class="profile-edit-btn" id="openProfileEditModalButton" title="Editar Perfil">
                        <i class="fas fa-edit"></i>
                    </button>

                    <!-- El contenido del perfil se cargará aquí dinámicamente -->
                    <div class="profile-grid-container">
                        <div class="profile-left-column">
                            <img src="https://placehold.co/150x150/7d3490/ffffff?text=U" alt="Avatar de Perfil" class="profile-avatar-large">
                            <h2>Usuario The Red</h2>
                            <div class="profile-contact-section">
                                <!-- Enlaces de contacto se cargarán aquí -->
                            </div>
                        </div>
                        <div class="profile-right-column">
                            <div id="myPhotosSectionContainer" class="profile-preview-section">
                                <h3 class="profile-section-title-purple">Mis Fotos</h3>
                                <div class="profile-photo-grid">
                                    <!-- Las fotos se cargarán aquí y al hacer clic se mostrarán -->
                                    <div class="profile-photo-placeholder">
                                         <img src="https://placehold.co/100x100/e01030/ffffff?text=Foto1" alt="Foto de perfil 1">
                                    </div>
                                    <div class="profile-photo-placeholder">
                                         <img src="https://placehold.co/100x100/e01030/ffffff?text=Foto2" alt="Foto de perfil 2">
                                    </div>
                                    <div class="profile-photo-placeholder">
                                         <img src="https://placehold.co/100x100/e01030/ffffff?text=Foto3" alt="Foto de perfil 3">
                                    </div>
                                </div>
                            </div>
                            <div id="aboutMeSectionContainer" class="profile-preview-section">
                                <h3>Acerca de Mí</h3>
                                <p>¡Hola! Soy un usuario de The Red. Me encanta explorar el universo y conectar con mentes creativas.</p>
                            </div>
                            <div id="interestsSectionContainer" class="profile-preview-section">
                                <h3>Intereses</h3>
                                <ul>
                                    <li><i class="fas fa-tag"></i> espacio</li>
                                    <li><i class="fas fa-tag"></i> ciencia</li>
                                    <li><i class="fas fa-tag"></i> tecnología</li>
                                </ul>
                            </div>
                            <div id="myMusicSectionContainer" class="profile-preview-section">
                                <h3>Mi Música</h3>
                                <div class="profile-music-links">
                                    <!-- Enlaces de música se cargarán aquí -->
                                </div>
                            </div>
                            <div id="customContentSectionContainer" class="profile-preview-section custom-content-area">
                                <h3>Contenido Personalizado</h3>
                                <p>¡Bienvenido a mi espacio en The Red!</p>
                            </div>
                            <!-- === NUEVA SECCIÓN DE PUBLICACIONES === -->
                            <div id="myPostsSectionContainer" class="profile-preview-section">
                                <h3>Publicaciones Recientes</h3>
                                <div id="posts-container">
                                    <!-- Las publicaciones se cargarán aquí dinámicamente -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section> <!-- Fin Contenido de la Página Mi Perfil -->

        </main>

        <!-- Pie de página (Footer) -->
        <footer class="main-footer">
            <nav class="footer-nav">
                <a href="#" class="nav-item" id="navMenu">
                    <i class="fas fa-bars"></i>
                    <span>Menú</span>
                </a>
                <a href="home.html" class="nav-item" id="navHome">
                    <i class="fas fa-home"></i>
                    <span>Inicio</span>
                </a>
                <a href="discover.html" class="nav-item" id="navDiscover">
                    <i class="fas fa-compass"></i>
                    <span>Descubrir</span>
                </a>
                <a href="my-network.html" class="nav-item" id="navMyRed">
                    <i class="fas fa-users"></i>
                    <span>Mi Red</span>
                </a>
                <a href="my-profile.html" class="nav-item active" id="navProfile">
                    <i class="fas fa-user-circle"></i>
                    <span>Perfil</span>
                </a>
                <a href="#" class="nav-item" id="navRewards">
                    <i class="fas fa-star"></i>
                    <span>Recompensas</span>
                </a>
            </nav>
        </div>

        <!-- Menú Lateral Izquierdo (para el botón "Menú") -->
        <div class="side-menu-left" id="sideMenu">
            <div class="side-menu-header">
                <span class="side-menu-title" id="sideMenuMainTitle">Menú Principal</span>
                <button class="side-menu-close-btn" id="closeSideMenuBtn">×</button>
            </div>
            <!-- Contenedor para la navegación principal del menú lateral -->
            <nav class="side-menu-nav" id="sideMenuNavContent">
                <a href="#" class="side-menu-item" id="sideMenuMission"><i class="fas fa-bullseye"></i> Misión</a>
                <a href="#" class="side-menu-item" id="sideMenuWhoAreWe"><i class="fas fa-users"></i> Quiénes Somos</a>
                <a href="#" class="side-menu-item" id="sideMenuPrices"><i class="fas fa-tag"></i> Precios</a>
                <a href="#" class="side-menu-item" id="sideMenuSupport"><i class="fas fa-question-circle"></i> Soporte y Ayuda</a>
                <a href="#" class="side-menu-item" id="sideMenuDevelopers"><i class="fas fa-code"></i> Desarrolladores</a>
                <a href="#" class="side-menu-item" id="sideMenuLogout"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
            </nav>
        </div>

        <!-- Menú Lateral Derecho (para el botón "Recompensas") -->
        <div class="side-menu-right" id="rewardsSideMenu">
            <div class="side-menu-header">
                <span class="side-menu-title">Recompensas</span>
                <button class="side-menu-close-btn" id="closeRewardsSideMenuBtn">×</button>
            </div>
            <nav class="side-menu-nav">
                <a href="#" class="side-menu-item" data-message="Mostrando tus puntos."><i class="fas fa-star"></i> Mis Puntos</a>
                <a href="#" class="side-menu-item" data-message="Abriendo la tienda de recompensas."><i class="fas fa-gift"></i> Canjear Recompensas</a>
                <a href="#" class="side-menu-item" data-message="Mostrando tus logros."><i class="fas fa-trophy"></i> Logros</a>
                <a href="#" class="side-menu-item" data-message="Consultando tu historial de recompensas."><i class="fas fa-chart-line"></i> Historial</a>
            </nav>
        </div>

        <!-- Botón flotante para la ventana de chat -->
        <button class="floating-chat-button" id="chatButton">
            <i class="fas fa-comments"></i>
        </button>

        <!-- Modales (se incluyen en cada HTML para simplificar, pero se pueden mover a un archivo común si se desea) -->
        <!-- Modal de confirmación genérico -->
        <div class="modal-overlay hidden" id="confirmationModal">
            <div class="modal-content">
                <p class="modal-message" id="confirmationMessage"></p>
                <div class="modal-actions">
                  <button class="modal-button confirm-button" id="confirmOkButton">OK</button>
                </div>
            </div>
        </div>

    

    </div> <!-- Cierre de app-container -->

    <!-- Modal de Edición de Perfil -->
    <div class="modal-overlay hidden" id="profileEditModal">
        <div class="modal-content">
            <h2 style="color: var(--light-purple);">Editar Perfil</h2>
            <div style="text-align: left; max-height: 70vh; overflow-y: auto; padding-right: 15px;">
                <div class="profile-edit-form-section">
                    <div class="profile-edit-form-group">
                        <label for="profileUsernameInput">Nombre de Usuario:</label>
                        <input type="text" id="profileUsernameInput" class="modal-input">
                    </div>
                    <!-- Campo de subida de Avatar -->
                    <div class="profile-edit-form-group">
                        <label for="profileAvatarUploadInput">Subir Avatar (Foto de Perfil):</label>
                        <input type="file" id="profileAvatarUploadInput" class="modal-input" accept="image/*">
                        <div id="profileAvatarPreview" class="image-upload-preview" style="height: 80px; width: 80px; border-radius: 50%;">
                            <!-- La vista previa del avatar se cargará aquí -->
                            <p style="color: #bbb; font-size: 0.9em;">No se ha seleccionado ninguna imagen</p>
                        </div>
                    </div>
                    <!-- Campo de subida de Fondo de Perfil -->
                    <div class="profile-edit-form-group">
                        <label for="profileBackgroundUploadInput">Subir Fondo de Perfil:</label>
                        <input type="file" id="profileBackgroundUploadInput" class="modal-input" accept="image/*">
                        <div id="profileBackgroundPreview" class="image-upload-preview" style="min-height: 100px;">
                            <!-- La vista previa del fondo se cargará aquí -->
                            <p style="color: #bbb; font-size: 0.9em;">No se ha seleccionado ninguna imagen</p>
                        </div>
                    </div>

                    <h3 style="color: var(--light-purple); margin-top: 10px; margin-bottom: 5px;">Colores del Perfil:</h3>
                    <div class="profile-edit-form-group color-inputs-grid">
                        <div>
                            <label for="profilePrimaryTextColorInput">Color Primario:</label>
                            <input type="color" id="profilePrimaryTextColorInput" class="modal-input">
                        </div>
                        <div>
                            <label for="profileSecondaryTextColorInput">Color Secundario:</label>
                            <input type="color" id="profileSecondaryTextColorInput" class="modal-input">
                        </div>
                        <div>
                            <label for="profileCardBackgroundColorInput">Fondo Tarjetas:</label>
                            <input type="color" id="profileCardBackgroundColorInput" class="modal-input">
                        </div>
                        <div>
                            <label for="profileBorderColorInput">Color Borde:</label>
                            <input type="color" id="profileBorderColorInput" class="modal-input">
                        </div>
                    </div>

                    <h3 style="color: var(--light-purple); margin-top: 10px; margin-bottom: 5px;">Contenido del Perfil:</h3>
                    <div class="profile-edit-form-group">
                        <label for="aboutMeContentInput">Acerca de Mí:</label>
                        <textarea id="aboutMeContentInput" class="modal-input" rows="4" placeholder="Escribe algo sobre ti..."></textarea>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showAboutMeCheckbox"> <label for="showAboutMeCheckbox">Mostrar sección "Acerca de Mí"</label>
                        </div>
                    </div>
                    <div class="profile-edit-form-group">
                        <label for="interestsContentInput">Intereses:</label>
                        <textarea id="interestsContentInput" class="modal-input" rows="3" placeholder="Separar intereses con comas (ej: espacio, ciencia, música)"></textarea>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showInterestsCheckbox"> <label for="showInterestsCheckbox">Mostrar sección "Intereses"</label>
                        </div>
                    </div>
                    <!-- Campo de subida de Mis Fotos -->
                    <div class="profile-edit-form-group">
                        <label for="myPhotosUploadInput">Subir Mis Fotos:</label>
                        <input type="file" id="myPhotosUploadInput" class="modal-input" accept="image/*" multiple>
                        <div id="myPhotosPreview" class="image-upload-preview">
                            <!-- Las vistas previas de Mis Fotos se cargarán aquí -->
                            <p style="color: #bbb; font-size: 0.9em;">No se ha seleccionado ninguna imagen</p>
                        </div>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showMyPhotosCheckbox"> <label for="showMyPhotosCheckbox">Mostrar sección "Mis Fotos"</label>
                        </div>
                    </div>

                    <div class="profile-edit-form-group">
                        <label style="display: block; margin-bottom: 5px; color: var(--light-red);">Enlaces de Música:</label>
                        <label for="myMusicSpotifyInput" style="display: block; margin-bottom: 5px; color: var(--light-red); font-weight: normal; font-size: 0.9em;">URL Spotify:</label>
                        <input type="text" id="myMusicSpotifyInput" class="modal-input" placeholder="https://open.spotify.com/artist/...">
                        <label for="myMusicYoutubeInput" style="display: block; margin-top: 10px; margin-bottom: 5px; color: var(--light-red); font-weight: normal; font-size: 0.9em;">URL YouTube Music:</label>
                        <input type="text" id="myMusicYoutubeInput" class="modal-input" placeholder="https://www.youtube.com/channel/...">
                        <label for="myMusicSoundcloudInput" style="display: block; margin-top: 10px; margin-bottom: 5px; color: var(--light-red); font-weight: normal; font-size: 0.9em;">URL SoundCloud:</label>
                        <input type="text" id="myMusicSoundcloudInput" class="modal-input" placeholder="https://soundcloud.com/...">
                        <div class="checkbox-group">
                            <input type="checkbox" id="showMyMusicCheckbox"> <label for="showMyMusicCheckbox">Mostrar sección "Mi Música"</label>
                        </div>
                    </div>
                    <div class="profile-edit-form-group">
                        <label for="customContentInput">Contenido Personalizado (solo texto):</label>
                        <textarea id="customContentInput" class="modal-input" rows="4" placeholder="Citas, mensajes especiales, etc."></textarea>
                        <div class="checkbox-group">
                            <input type="checkbox" id="showCustomContentCheckbox"> <label for="showCustomContentCheckbox">Mostrar sección "Contenido Personalizado"</label>
                        </div>
                    </div>

                    <h3 style="color: var(--light-purple); margin-top: 10px; margin-bottom: 5px;">Enlaces de Contacto:</h3>
                    <div class="profile-edit-form-group">
                        <label for="whatsappUrlInput">URL WhatsApp:</label>
                        <input type="text" id="whatsappUrlInput" class="modal-input" placeholder="https://wa.me/...">
                    </div>
                    <div class="profile-edit-form-group">
                        <label for="instagramUrlInput">URL Instagram:</label>
                        <input type="text" id="instagramUrlInput" class="modal-input" placeholder="https://instagram.com/...">
                    </div>
                    <div class="profile-edit-form-group">
                        <label for="facebookUrlInput">URL Facebook:</label>
                        <input type="text" id="facebookUrlInput" class="modal-input" placeholder="https://facebook.com/...">
                    </div>
                    <div class="profile-edit-form-group">
                        <label for="twitterUrlInput">URL Twitter:</label>
                        <input type="text" id="twitterUrlInput" class="modal-input" placeholder="https://twitter.com/...">
                    </div>
                </div>
            </div>
            <div class="modal-actions" style="margin-top: 30px; display: flex; justify-content: center; gap: 20px;">
                <button class="modal-button" id="saveProfileSettingsButton">Guardar Cambios</button>
                <button class="modal-button" id="resetProfileSettingsButton" style="background: linear-gradient(45deg, #6b7280, #4b5563);">Restablecer Predeterminados</button>
                <button class="modal-button" id="closeProfileEditModalButton" style="background: linear-gradient(45deg, #ef4444, #dc2626);">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal para Nueva Publicación -->
    <div class="modal-overlay hidden" id="newPostModal">
        <div class="modal-content">
            <h2 style="color: var(--light-purple);">Crear Nueva Publicación</h2>
            <div style="text-align: left; max-height: 70vh; overflow-y: auto; padding-right: 15px;">
                <div class="profile-edit-form-group">
                    <label for="newPostTextInput">Texto de la Publicación:</label>
                    <textarea id="newPostTextInput" class="modal-input" rows="6" placeholder="¿Qué tienes en mente?"></textarea>
                </div>
                <!-- CAMBIO: Campo de subida de imagen en lugar de URL -->
                <div class="profile-edit-form-group">
                    <label for="newPostImageUploadInput">Subir Imagen (opcional):</label>
                    <input type="file" id="newPostImageUploadInput" class="modal-input" accept="image/*">
                    <div id="newPostImagePreview" class="image-upload-preview" style="min-height: 100px; margin-top: 10px;">
                        <!-- La vista previa de la imagen se cargará aquí -->
                        <p style="color: #bbb; font-size: 0.9em;">No se ha seleccionado ninguna imagen</p>
                    </div>
                </div>
                <div class="profile-edit-form-group">
                    <label for="newPostKeywordsInput">Palabras Clave (separadas por comas):</label>
                    <input type="text" id="newPostKeywordsInput" class="modal-input" placeholder="ej: espacio, ciencia, arte">
                </div>
            </div>
            <div class="modal-actions" style="margin-top: 30px; display: flex; justify-content: center; gap: 20px;">
                <button class="modal-button" id="submitNewPostButton">Publicar</button>
                <button class="modal-button" id="closeNewPostModalButton" style="background: linear-gradient(45deg, #ef4444, #dc2626);">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Nuevo Modal Genérico para Información (Misión, Quiénes Somos) -->
    <div class="modal-overlay hidden" id="infoModal">
        <div class="info-modal-content">
            <button class="close-button" id="closeInfoModalBtn">×</button>
            <h2 id="infoModalTitle"></h2>
            <p class="modal-intro-text" id="infoModalIntroText"></p>
            <div class="modal-body-content" id="infoModalBodyContent">
                <!-- El contenido dinámico se cargará aquí -->
            </div>
        </div>
    </div>

    <!-- Nuevo Modal para Configuración de Idioma -->
    <div class="modal-overlay hidden" id="languageSettingsModal">
        <div class="modal-content">
            <h2 style="color: var(--light-purple);">Configuración de Idioma</h2>
            <div style="text-align: left; padding: 0 15px; max-height: 60vh; overflow-y: auto;">
                <p class="modal-message" style="text-align: center; font-size: 0.95em; margin-bottom: 20px;">
                    Selecciona tu idioma preferido para la interfaz de la aplicación.
                </p>
                <div class="language-options-group">
                    <div class="language-option">
                        <input type="radio" id="lang-es" name="language" value="es" checked>
                        <label for="lang-es">Español</label>
                    </div>
                    <div class="language-option">
                        <input type="radio" id="lang-en" name="language" value="en">
                        <label for="lang-en">English</label>
                    </div>
                    <!-- Puedes añadir más idiomas aquí -->
                </div>
            </div>
            <div class="modal-actions" style="margin-top: 30px;">
                <button class="modal-button" id="saveLanguageSettingsButton">Guardar Idioma</button>
                <button class="modal-button" id="closeLanguageSettingsModalButton" style="background: linear-gradient(45deg, #ef4444, #dc2626);">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Nuevo Modal para Pago de Suscripción -->
    <div class="modal-overlay hidden" id="paymentModal">
        <div class="modal-content">
            <h2 id="paymentModalTitle" style="color: var(--light-purple);">Comprar Suscripción</h2>
            <div style="text-align: left; max-height: 70vh; overflow-y: auto; padding-right: 15px;">
                <p class="modal-message" style="text-align: center; font-size: 0.95em; margin-bottom: 20px;">
                    Por favor, introduce tus datos de pago para completar la suscripción.
                </p>
                <div class="payment-form-section">
                    <div class="payment-form-group">
                        <label for="cardNumberInput">Número de Tarjeta:</label>
                        <input type="text" id="cardNumberInput" class="modal-input" placeholder="XXXX XXXX XXXX XXXX" maxlength="19">
                    </div>
                    <div class="payment-form-grid">
                        <div class="payment-form-group">
                            <label for="expiryDateInput">Fecha de Vencimiento (MM/AA):</label>
                            <input type="text" id="expiryDateInput" class="modal-input" placeholder="MM/AA" maxlength="5">
                        </div>
                        <div class="payment-form-group">
                            <label for="cvcInput">CVC:</label>
                            <input type="text" id="cvcInput" class="modal-input" placeholder="XXX" maxlength="4">
                        </div>
                    </div>
                    <div class="payment-form-group">
                        <label for="cardNameInput">Nombre en la Tarjeta:</label>
                        <input type="text" id="cardNameInput" class="modal-input" placeholder="Nombre Completo">
                    </div>
                    <div class="payment-form-group">
                        <label for="billingAddressInput">Dirección de Facturación:</label>
                        <input type="text" id="billingAddressInput" class="modal-input" placeholder="Calle, Ciudad, Código Postal">
                    </div>
                </div>
            </div>
            <div class="modal-actions" style="margin-top: 30px; display: flex; justify-content: center; gap: 20px;">
                <button class="modal-button" id="processPaymentButton">Pagar</button>
                <button class="modal-button" id="closePaymentModalButton" style="background: linear-gradient(45deg, #ef4444, #dc2626);">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Nuevo Modal para Vista Previa de Publicación -->
    <div class="modal-overlay hidden" id="postPreviewModal">
        <div class="post-preview-modal-content">
            <button class="close-button" id="closePostPreviewModalBtn">×</button>
            <h2 id="postPreviewTitle"></h2>
            <img id="postPreviewImage" src="" alt="Post Image" class="post-image-preview">
            <div class="post-author-info">
                <img id="postPreviewAuthorAvatar" src="" alt="Author Avatar">
                <div class="post-author-details">
                    <span class="username" id="postPreviewAuthorUsername"></span>
                    <span class="handle" id="postPreviewTimestamp"></span>
                </div>
            </div>
            <p id="postPreviewText" class="post-text"></p>
            <div id="postPreviewTags" class="post-tags"></div>
            <div class="modal-actions">
                <button class="modal-button" id="viewAuthorProfileBtn">Ver Perfil del Autor</button>
            </div>
        </div>
    </div>


    <!-- Menú Lateral Izquierdo (para el botón "Menú") -->
    <div class="side-menu-left" id="sideMenu">
        <div class="side-menu-header">
            <span class="side-menu-title" id="sideMenuMainTitle">Menú Principal</span>
            <button class="side-menu-close-btn" id="closeSideMenuBtn">×</button>
        </div>
        <!-- Contenedor para la navegación principal del menú lateral -->
        <nav class="side-menu-nav" id="sideMenuNavContent">
            <a href="#" class="side-menu-item" id="sideMenuMission"><i class="fas fa-bullseye"></i> Misión</a>
            <a href="#" class="side-menu-item" id="sideMenuWhoAreWe"><i class="fas fa-users"></i> Quiénes Somos</a>
            <a href="#" class="side-menu-item" id="sideMenuPrices"><i class="fas fa-tag"></i> Precios</a> <!-- Nuevo botón Precios -->
            <a href="#" class="side-menu-item" id="sideMenuSupport"><i class="fas fa-question-circle"></i> Soporte y Ayuda</a>
            <a href="#" class="side-menu-item" id="sideMenuDevelopers"><i class="fas fa-code"></i> Desarrolladores</a> <!-- Nuevo botón Desarrolladores -->
            <a href="#" class="side-menu-item" id="sideMenuLogout"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
        </nav>
    </div>

    <!-- Menú Lateral Derecho (para el botón "Recompensas") -->
    <div class="side-menu-right" id="rewardsSideMenu">
        <div class="side-menu-header">
            <span class="side-menu-title">Recompensas</span>
            <button class="side-menu-close-btn" id="closeRewardsSideMenuBtn">×</button>
        </div>
        <nav class="side-menu-nav">
            <a href="#" class="side-menu-item" data-message="Mostrando tus puntos."><i class="fas fa-star"></i> Mis Puntos</a>
            <a href="#" class="side-menu-item" data-message="Abriendo la tienda de recompensas."><i class="fas fa-gift"></i> Canjear Recompensas</a>
            <a href="#" class="side-menu-item" data-message="Mostrando tus logros."><i class="fas fa-trophy"></i> Logros</a>
            <a href="#" class="side-menu-item" data-message="Consultando tu historial de recompensas."><i class="fas fa-chart-line"></i> Historial</a>
        </nav>
    </div>

    <script type="module">
        // --- INICIALIZACIÓN DE FIREBASE (Sintaxis Moderna v9+) ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, updateProfile, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, getDocs, query, orderBy, onSnapshot, enableNetwork, disableNetwork, where, limit } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // --- SISTEMA DE CACHÉ PARA OPTIMIZACIÓN ---
        class ProfileCache {
            constructor() {
                this.cache = new Map();
                this.timestamps = new Map();
                this.CACHE_DURATION = 5 * 60 * 1000; // 5 minutos
                this.loadingStates = new Map();
            }

            isValid(key) {
                const timestamp = this.timestamps.get(key);
                if (!timestamp) return false;
                return (Date.now() - timestamp) < this.CACHE_DURATION;
            }

            set(key, data) {
                this.cache.set(key, data);
                this.timestamps.set(key, Date.now());
                // Guardar en localStorage para persistencia
                try {
                    localStorage.setItem(`profile_cache_${key}`, JSON.stringify({
                        data,
                        timestamp: Date.now()
                    }));
                } catch (e) {
                    console.warn('No se pudo guardar en localStorage:', e);
                }
            }

            get(key) {
                // Primero verificar caché en memoria
                if (this.isValid(key)) {
                    return this.cache.get(key);
                }

                // Verificar localStorage
                try {
                    const stored = localStorage.getItem(`profile_cache_${key}`);
                    if (stored) {
                        const { data, timestamp } = JSON.parse(stored);
                        if ((Date.now() - timestamp) < this.CACHE_DURATION) {
                            this.cache.set(key, data);
                            this.timestamps.set(key, timestamp);
                            return data;
                        } else {
                            localStorage.removeItem(`profile_cache_${key}`);
                        }
                    }
                } catch (e) {
                    console.warn('Error al leer localStorage:', e);
                }

                return null;
            }

            invalidate(key) {
                this.cache.delete(key);
                this.timestamps.delete(key);
                try {
                    localStorage.removeItem(`profile_cache_${key}`);
                } catch (e) {
                    console.warn('Error al limpiar localStorage:', e);
                }
            }

            clear() {
                this.cache.clear();
                this.timestamps.clear();
                // Limpiar localStorage
                try {
                    Object.keys(localStorage).forEach(key => {
                        if (key.startsWith('profile_cache_')) {
                            localStorage.removeItem(key);
                        }
                    });
                } catch (e) {
                    console.warn('Error al limpiar localStorage:', e);
                }
            }

            setLoading(key, isLoading) {
                this.loadingStates.set(key, isLoading);
            }

            isLoading(key) {
                return this.loadingStates.get(key) || false;
            }
        }

        // Instancia global del caché
        const profileCache = new ProfileCache();

        const firebaseConfig = {
            apiKey: "AIzaSyApU8UbfqfzBH1UPU3a1CQGf1p995Rf0y4",
            authDomain: "the-red-loggin.firebaseapp.com",
            projectId: "the-red-loggin",
            storageBucket: "the-red-loggin.appspot.com",
            messagingSenderId: "40265573777",
            appId: "1:40265573777:web:1651cb4119969010ea2630"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // --- MANEJO DE LA SESIÓN DEL USUARIO ---
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                console.log("Usuario autenticado:", user.uid);
                
                try {
                    // Verificar token de autenticación sin delay innecesario
                    const token = await user.getIdToken();
                    console.log("Token de autenticación obtenido");
                    
                    // Limpiar contador de reintentos al iniciar sesión exitosa
                    profileCache.invalidate(`retry_count_${user.uid}`);
                    
                    await cargarYMostrarDatosPerfil(user.uid);
                    await cargarPublicacionesUsuario(user.uid);
                } catch (error) {
                    console.error("Error en la autenticación inicial:", error);
                    if (error.code === 'permission-denied') {
                        showConfirmationModal("Error de permisos de Firestore. Contacta al administrador.");
                    } else {
                        showConfirmationModal("Error de autenticación. Por favor, inicia sesión nuevamente.");
                        setTimeout(() => {
                            window.location.href = '../login.html';
                        }, 3000);
                    }
                }
            } else {
                console.log("Ningún usuario autenticado, redirigiendo al login.");
                window.location.href = '../login.html';
            }
        });

        // =========================================================
        // === FUNCIONES DE UTILIADAD (SIN CAMBIOS) ===
        // =========================================================
        function showConfirmationModal(message) {
            document.getElementById('confirmationMessage').textContent = message;
            document.getElementById('confirmationModal').classList.remove('hidden');
        }

        document.getElementById('confirmOkButton').addEventListener('click', () => {
            document.getElementById('confirmationModal').classList.add('hidden');
        });
        
        // =========================================================
        // === LÓGICA PRINCIPAL DE LA PÁGINA DE PERFIL (ACTUALIZADA) ===
        // =========================================================

        // --- FUNCIONES OPTIMIZADAS CON CACHÉ ---
        
        // Función para mostrar/ocultar loading spinner
        function showLoadingSpinner(containerId, show = true) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            if (show) {
                container.innerHTML = `
                    <div class="loading-spinner" style="text-align: center; padding: 40px;">
                        <div style="border: 4px solid rgba(255, 48, 88, 0.3); border-top: 4px solid var(--light-red); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                        <p style="color: var(--gray-medium); margin-top: 15px;">Cargando...</p>
                    </div>
                    <style>
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                    </style>
                `;
            }
        }

        async function cargarYMostrarDatosPerfil(uid, forceRefresh = false) {
            const cacheKey = `profile_${uid}`;
            
            // Verificar si ya está cargando para evitar consultas duplicadas
            if (profileCache.isLoading(cacheKey) && !forceRefresh) {
                console.log("Perfil ya está cargando, esperando...");
                return;
            }
            
            // Verificar caché primero si no es refresh forzado
            if (!forceRefresh) {
                const cachedData = profileCache.get(cacheKey);
                if (cachedData) {
                    console.log("Datos del perfil cargados desde caché");
                    aplicarDatosPerfilAUI(cachedData);
                    cargarDatosEnModalEdicion(cachedData);
                    return;
                }
            }
            
            try {
                profileCache.setLoading(cacheKey, true);
                console.log("Cargando perfil desde Firestore para UID:", uid);
                
                // Verificar autenticación antes de hacer consultas
                const user = auth.currentUser;
                if (!user) {
                    console.error("Usuario no autenticado");
                    window.location.href = 'login.html';
                    return;
                }
                
                // Obtener token fresco para asegurar permisos
                await user.getIdToken(true);
                
                // Cargar datos del perfil
                const userDocRef = doc(db, 'users', uid);
                const docSnap = await getDoc(userDocRef);
                
                if (docSnap.exists()) {
                    const userData = docSnap.data();
                    console.log("Datos del perfil obtenidos:", userData);
                    
                    // Guardar en caché
                    profileCache.set(cacheKey, userData);
                    
                    // Aplicar datos a la UI
                    await aplicarDatosPerfilAUI(userData);
                    cargarDatosEnModalEdicion(userData);
                    
                    // Cargar publicaciones después del perfil
                    await cargarPublicacionesUsuario(uid, forceRefresh);
                    
                } else {
                    console.log("Perfil no existe, creando perfil por defecto...");
                    await crearPerfilPorDefecto(uid);
                    // Recargar después de crear el perfil
                    await cargarYMostrarDatosPerfil(uid, true);
                }
                
            } catch (error) {
                console.error("Error al cargar datos del perfil:", error);
                
                // Manejo específico de errores de permisos
                if (error.code === 'permission-denied') {
                    console.log("Error de permisos detectado, verificando autenticación...");
                    
                    const user = auth.currentUser;
                    if (!user) {
                        console.error("Usuario no autenticado, redirigiendo al login");
                        window.location.href = 'login.html';
                        return;
                    }
                    
                    try {
                        // Intentar renovar token una vez más
                        await user.getIdToken(true);
                        console.log("Token renovado, reintentando en 2 segundos...");
                        
                        setTimeout(() => {
                            cargarYMostrarDatosPerfil(uid, true);
                        }, 2000);
                        return;
                        
                    } catch (tokenError) {
                        console.error("Error al renovar token:", tokenError);
                    }
                }
                
                // Mostrar error en la UI
                const profileView = document.querySelector('.profile-view-container');
                if (profileView) {
                    profileView.innerHTML = `
                        <div class="error-message" style="text-align: center; padding: 2rem; color: #ff6b6b; background: rgba(255, 107, 107, 0.1); border-radius: 12px; margin: 1rem;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 3em; margin-bottom: 1rem;"></i>
                            <h3>Error al cargar el perfil</h3>
                            <p style="margin: 1rem 0;">${error.message}</p>
                            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1.5rem;">
                                <button onclick="cargarYMostrarDatosPerfil('${uid}', true)" class="btn-primary">
                                    <i class="fas fa-redo"></i> Reintentar
                                </button>
                                <button onclick="location.reload()" class="btn-secondary">
                                    <i class="fas fa-refresh"></i> Recargar
                                </button>
                            </div>
                        </div>
                    `;
                }
            } finally {
                profileCache.setLoading(cacheKey, false);
            }
        }

        // Función separada para aplicar datos a la UI
        async function aplicarDatosPerfilAUI(userData) {
            const profileView = document.querySelector('.profile-view-container');
            if (!profileView) return;

            // Actualizar imagen de avatar con loading optimizado
            const avatarImg = profileView.querySelector('.profile-avatar-large');
            if (avatarImg) {
                const avatarUrl = userData.avatarUrl || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.username || 'Usuario')}&size=150&background=7d3490&color=ffffff&bold=true`;
                
                // Precargar imagen para evitar parpadeo
                const img = new Image();
                img.onload = () => {
                    avatarImg.src = avatarUrl;
                };
                img.src = avatarUrl;
            }
            
            const usernameElement = profileView.querySelector('h2');
            if (usernameElement) {
                usernameElement.textContent = userData.username || 'Usuario The Red';
            }

            // Actualizar secciones en paralelo usando DocumentFragment para mejor rendimiento
            const fragment = document.createDocumentFragment();
            
            // Actualizar sección "Acerca de Mí"
            const aboutMeSection = document.querySelector('#aboutMeSectionContainer p');
            if (aboutMeSection && userData.aboutMe) {
                aboutMeSection.textContent = userData.aboutMe;
            }

            // Actualizar sección "Intereses" con mejor rendimiento
            const interestsSection = document.querySelector('#interestsSectionContainer ul');
            if (interestsSection && userData.interests) {
                const interests = userData.interests.split(',');
                const interestsList = interests.map(interest => 
                    `<li><i class="fas fa-tag"></i> ${interest.trim()}</li>`
                ).join('');
                interestsSection.innerHTML = interestsList;
            }

            // Actualizar enlaces de contacto
            const contactSection = profileView.querySelector('.profile-contact-section');
            if (contactSection) {
                const contactLinks = [
                    userData.website && `<a href="${userData.website}" target="_blank" class="contact-link"><i class="fas fa-globe"></i> Sitio Web</a>`,
                    userData.twitter && `<a href="https://twitter.com/${userData.twitter}" target="_blank" class="contact-link"><i class="fab fa-twitter"></i> Twitter</a>`,
                    userData.instagram && `<a href="https://instagram.com/${userData.instagram}" target="_blank" class="contact-link"><i class="fab fa-instagram"></i> Instagram</a>`,
                    userData.linkedin && `<a href="https://linkedin.com/in/${userData.linkedin}" target="_blank" class="contact-link"><i class="fab fa-linkedin"></i> LinkedIn</a>`
                ].filter(Boolean);
                
                contactSection.innerHTML = contactLinks.join('');
            }

            // Actualizar fotos del perfil con lazy loading
            const photoGrid = profileView.querySelector('.profile-photo-grid');
            if (photoGrid && userData.photos && userData.photos.length > 0) {
                const photosHTML = userData.photos.map(photo => 
                    `<div class="profile-photo-placeholder" onclick="showImageModal('${photo}', '${userData.username}')">
                        <img src="${photo}" alt="Foto del perfil" loading="lazy">
                    </div>`
                ).join('');
                photoGrid.innerHTML = photosHTML;
            }
        }

        // Función para crear perfil por defecto
        async function crearPerfilPorDefecto(uid) {
            const user = auth.currentUser;
            const username = user?.displayName || 'Usuario The Red';
            
            const defaultProfile = {
                username: username,
                email: user?.email || '',
                aboutMe: `¡Hola! Soy ${username}. Me encanta explorar el universo y conectar con mentes creativas.`,
                interests: 'espacio, ciencia, tecnología',
                location: '',
                website: '',
                twitter: '',
                instagram: '',
                linkedin: '',
                avatarUrl: user?.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&size=150&background=7d3490&color=ffffff&bold=true`,
                backgroundUrl: '',
                photos: [],
                customContent: `¡Bienvenido a mi espacio en The Red!`,
                primaryTextColor: '#ff3058',
                secondaryTextColor: '#7d3490',
                cardBackgroundColor: 'rgba(74, 26, 85, 0.4)',
                borderColor: '#ff3058',
                createdAt: new Date(),
                updatedAt: new Date()
            };

            try {
                const userRef = doc(db, 'users', uid);
                await setDoc(userRef, defaultProfile, { merge: true });
                console.log('Perfil por defecto creado');
            } catch (error) {
                console.error('Error al crear perfil por defecto:', error);
            }
        }

        // === FUNCIÓN OPTIMIZADA PARA CARGAR PUBLICACIONES CON CACHÉ ===
        async function cargarPublicacionesUsuario(uid, forceRefresh = false) {
            const postsContainer = document.getElementById('posts-container');
            if (!postsContainer) {
                console.log("Contenedor de posts no encontrado");
                return;
            }

            const cacheKey = `posts_${uid}`;
            
            // Verificar si ya está cargando
            if (profileCache.isLoading(cacheKey) && !forceRefresh) {
                console.log("Publicaciones ya están cargando, esperando...");
                return;
            }

            // Verificar caché primero
            if (!forceRefresh) {
                const cachedPosts = profileCache.get(cacheKey);
                if (cachedPosts) {
                    console.log("Publicaciones cargadas desde caché:", cachedPosts.length);
                    renderizarPublicaciones(cachedPosts, postsContainer);
                    return;
                }
            }

            try {
                profileCache.setLoading(cacheKey, true);
                console.log("Cargando publicaciones desde Firestore para UID:", uid);
                
                // Mostrar loading spinner
                postsContainer.innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="spinner"></div><p>Cargando publicaciones...</p></div>';
                
                // Intentar cargar desde subcollección del usuario primero
                let userPosts = [];
                
                try {
                    // Opción 1: Cargar desde subcollección del usuario (más eficiente)
                    const userPostsRef = collection(db, 'users', uid, 'posts');
                    const userQuery = query(userPostsRef, orderBy('timestamp', 'desc'), limit(20));
                    const userSnapshot = await getDocs(userQuery);
                    
                    userSnapshot.forEach((doc) => {
                        userPosts.push({ id: doc.id, ...doc.data() });
                    });
                    
                    console.log("Publicaciones del usuario desde subcollección:", userPosts.length);
                    
                } catch (subcollectionError) {
                    console.log("Error en subcollección, intentando consulta global:", subcollectionError.message);
                    
                    // Opción 2: Fallback a consulta global sin orderBy para evitar índices
                    try {
                        const globalPostsRef = collection(db, 'posts');
                        const globalQuery = query(globalPostsRef, where('authorId', '==', uid), limit(20));
                        const globalSnapshot = await getDocs(globalQuery);
                        
                        globalSnapshot.forEach((doc) => {
                            userPosts.push({ id: doc.id, ...doc.data() });
                        });
                        
                        // Ordenar en cliente
                        userPosts.sort((a, b) => {
                            const aTime = a.timestamp?.toDate?.() || new Date(0);
                            const bTime = b.timestamp?.toDate?.() || new Date(0);
                            return bTime - aTime;
                        });
                        
                        console.log("Publicaciones del usuario desde consulta global:", userPosts.length);
                        
                    } catch (globalError) {
                        console.log("Error en consulta global, cargando todas las publicaciones:", globalError.message);
                        
                        // Opción 3: Último recurso - cargar todas y filtrar
                        const allPostsRef = collection(db, 'posts');
                        const allSnapshot = await getDocs(allPostsRef);
                        
                        allSnapshot.forEach((doc) => {
                            const post = doc.data();
                            if (post.authorId === uid) {
                                userPosts.push({ id: doc.id, ...post });
                            }
                        });
                        
                        // Ordenar en cliente
                        userPosts.sort((a, b) => {
                            const aTime = a.timestamp?.toDate?.() || new Date(0);
                            const bTime = b.timestamp?.toDate?.() || new Date(0);
                            return bTime - aTime;
                        });
                        
                        console.log("Publicaciones filtradas del total:", userPosts.length);
                    }
                }

                console.log("Publicaciones del usuario encontradas:", userPosts.length);
                
                // Guardar en caché
                profileCache.set(cacheKey, userPosts);
                
                // Renderizar publicaciones
                renderizarPublicaciones(userPosts, postsContainer);

            } catch (error) {
                console.error("Error al cargar publicaciones:", error);
                
                // Verificar si es un error de permisos y intentar renovar token
                if (error.code === 'permission-denied') {
                    console.log("Error de permisos, intentando renovar token...");
                    try {
                        const user = auth.currentUser;
                        if (user) {
                            await user.getIdToken(true); // Forzar renovación
                            console.log("Token renovado, reintentando carga de publicaciones...");
                            setTimeout(() => cargarPublicacionesUsuario(uid, true), 1000);
                            return;
                        }
                    } catch (tokenError) {
                        console.error("Error al renovar token:", tokenError);
                    }
                }
                
                // Mostrar mensaje de error con opciones
                postsContainer.innerHTML = `
                    <div class="no-posts-message">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2em; color: #ff6b6b; margin-bottom: 1rem;"></i>
                        <h3>Error al cargar publicaciones</h3>
                        <p style="margin-bottom: 1rem;">${error.message}</p>
                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button onclick="cargarPublicacionesUsuario('${uid}', true)" class="retry-btn">
                                <i class="fas fa-redo"></i> Reintentar
                            </button>
                            <button onclick="location.reload()" class="retry-btn" style="background: #666;">
                                <i class="fas fa-refresh"></i> Recargar página
                            </button>
                        </div>
                    </div>
                `;
            } finally {
                profileCache.setLoading(cacheKey, false);
            }
        }

        // Función separada para renderizar publicaciones
        function renderizarPublicaciones(userPosts, container) {
            if (userPosts.length === 0) {
                container.innerHTML = '<p class="no-posts-message">Aún no has creado ninguna publicación.</p>';
                return;
            }

            let postsHTML = '';
            userPosts.forEach((post) => {
                const postDate = post.timestamp ? new Date(post.timestamp.seconds * 1000).toLocaleString() : 'Fecha no disponible';
                
                postsHTML += `
                    <div class="post-card">
                        ${post.imageUrl ? `<img src="${post.imageUrl}" alt="Imagen de la publicación" style="max-width: 100%; border-radius: 10px; margin-bottom: 10px;">` : ''}
                        <p style="margin-bottom: 10px;">${post.text || 'Sin contenido de texto'}</p>
                        <span class="post-date" style="color: #999; font-size: 0.9em;">${postDate}</span>
                        ${post.keywords && post.keywords.length > 0 ? `
                            <div class="post-tags" style="margin-top: 10px;">
                                ${post.keywords.map(tag => `<span class="tag" style="background: var(--light-purple); padding: 2px 8px; border-radius: 12px; font-size: 0.8em; margin-right: 5px;">#${tag}</span>`).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            container.innerHTML = postsHTML;
        }

        function cargarDatosEnModalEdicion(userData) {
            // Campos básicos del perfil
            const setInputValue = (id, value) => {
                const element = document.getElementById(id);
                if (element) element.value = value || '';
            };

            const setCheckboxValue = (id, value) => {
                const element = document.getElementById(id);
                if (element) element.checked = value || false;
            };

            // Cargar datos básicos
            setInputValue('profileUsernameInput', userData.username);
            setInputValue('aboutMeContentInput', userData.aboutMe);
            setInputValue('interestsContentInput', userData.interests);
            setInputValue('customContentInput', userData.customContent);

            // Checkboxes de visibilidad
            setCheckboxValue('showAboutMeCheckbox', userData.showAboutMe);
            setCheckboxValue('showInterestsCheckbox', userData.showInterests);
            setCheckboxValue('showMyPhotosCheckbox', userData.showMyPhotos);
            setCheckboxValue('showMyMusicCheckbox', userData.showMyMusic);
            setCheckboxValue('showCustomContentCheckbox', userData.showCustomContent);

            // Colores personalizados
            setInputValue('profilePrimaryTextColorInput', userData.primaryTextColor || '#ff3058');
            setInputValue('profileSecondaryTextColorInput', userData.secondaryTextColor || '#7d3490');
            setInputValue('profileCardBackgroundColorInput', userData.cardBackgroundColor || 'rgba(74, 26, 85, 0.4)');
            setInputValue('profileBorderColorInput', userData.borderColor || '#ff3058');

            // Enlaces de música y redes sociales
            setInputValue('myMusicSpotifyInput', userData.myMusicSpotifyUrl);
            setInputValue('myMusicYoutubeInput', userData.myMusicYoutubeUrl);
            setInputValue('myMusicSoundcloudInput', userData.myMusicSoundcloudUrl);
            setInputValue('whatsappUrlInput', userData.whatsappUrl);
            setInputValue('instagramUrlInput', userData.instagramUrl);
            setInputValue('facebookUrlInput', userData.facebookUrl);
            setInputValue('twitterUrlInput', userData.twitterUrl);

            const avatarPreview = document.getElementById('profileAvatarPreview');
            if (userData.avatarUrl) {
                avatarPreview.innerHTML = `<div class="preview-item" style="width: 100%; height: 100%;"><img src="${userData.avatarUrl}" alt="Avatar Preview"><button class="remove-btn">×</button></div>`;
            } else {
                avatarPreview.innerHTML = `<p style="color: #bbb; font-size: 0.9em;">No se ha seleccionado ninguna imagen</p>`;
            }

            const backgroundPreview = document.getElementById('profileBackgroundPreview');
            if (userData.backgroundUrl) {
                backgroundPreview.innerHTML = `<div class="preview-item" style="width: 100%; height: 100px;"><img src="${userData.backgroundUrl}" alt="Background Preview"><button class="remove-btn">×</button></div>`;
            } else {
                backgroundPreview.innerHTML = `<p style="color: #bbb; font-size: 0.9em;">No se ha seleccionado ninguna imagen</p>`;
            }

            const myPhotosPreview = document.getElementById('myPhotosPreview');
            if (userData.myPhotos && userData.myPhotos.length > 0) {
                myPhotosPreview.innerHTML = userData.myPhotos.map((url, index) => `<div class="preview-item"><img src="${url}" alt="My Photo Preview ${index + 1}"><button class="remove-btn" data-index="${index}">×</button></div>`).join('');
            } else {
                myPhotosPreview.innerHTML = `<p style="color: #bbb; font-size: 0.9em;">No se ha seleccionado ninguna imagen</p>`;
            }
        }
        
        // --- MANEJADORES DE EVENTOS (SIN CAMBIOS EN LA LÓGICA) ---
        const openProfileEditModalButton = document.getElementById('openProfileEditModalButton');
        const closeProfileEditModalButton = document.getElementById('closeProfileEditModalButton');
        const saveProfileSettingsButton = document.getElementById('saveProfileSettingsButton');
        const resetProfileSettingsButton = document.getElementById('resetProfileSettingsButton');

        // Función específica para cargar datos en el modal, para no recargar toda la UI
        async function cargarDatosEnModalEdicionDesdeFirestore(uid) {
            const cacheKey = `profile_${uid}`;
            let userData = profileCache.get(cacheKey);

            if (!userData) {
                console.log("Cache miss for modal, fetching from Firestore");
                try {
                    const userDocRef = doc(db, 'users', uid);
                    const docSnap = await getDoc(userDocRef);
                    if (docSnap.exists()) {
                        userData = docSnap.data();
                        profileCache.set(cacheKey, userData); // Update cache
                    }
                } catch (error) {
                    console.error("Error fetching profile for modal:", error);
                    showConfirmationModal("No se pudieron cargar los datos para editar.");
                    return; // Abort if data can't be loaded
                }
            }
            
            if(userData) {
                cargarDatosEnModalEdicion(userData);
            }
        }

        openProfileEditModalButton.addEventListener('click', async () => {
            const user = auth.currentUser;
            if (user) {
                // Primero se cargan los datos por si el modal los necesita
                await cargarDatosEnModalEdicionDesdeFirestore(user.uid);
                // Luego se muestra el modal
                document.getElementById('profileEditModal').classList.remove('hidden');
            }
        });

        closeProfileEditModalButton.addEventListener('click', () => {
            document.getElementById('profileEditModal').classList.add('hidden');
        });

        resetProfileSettingsButton.addEventListener('click', async () => {
            if (confirm('¿Estás seguro de que quieres restablecer todos los valores a los predeterminados?')) {
                const user = auth.currentUser;
                const defaultData = {
                    username: user.displayName || '',
                    aboutMe: '¡Hola! Soy un usuario de The Red. Me encanta explorar el universo y conectar con mentes creativas.',
                    interests: 'espacio, ciencia, tecnología',
                    myPhotos: [],
                    whatsappUrl: '',
                    instagramUrl: '',
                    facebookUrl: '',
                    twitterUrl: '',
                    primaryTextColor: '#ff3058',
                    secondaryTextColor: '#7d3490',
                    cardBackgroundColor: 'rgba(74, 26, 85, 0.4)',
                    borderColor: '#ff3058',
                    showAboutMe: true,
                    showInterests: true,
                    showMyPhotos: true,
                    showMyMusic: false,
                    showCustomContent: false,
                };
                await setDoc(doc(db, 'users', user.uid), defaultData, { merge: true });
                await cargarYMostrarDatosPerfil(user.uid);
                showConfirmationModal('Configuración de perfil restablecida con éxito.');
            }
        });
        
        // --- MANEJO DE SUBIDA DE ARCHIVOS (ACTUALIZADO) ---
        let avatarFile = null;
        let backgroundFile = null;
        let myPhotosFiles = [];

        // --- MANEJADORES DE EVENTOS OPTIMIZADOS ---

        // Event listener optimizado para el botón de guardar perfil
        saveProfileSettingsButton.addEventListener('click', async () => {
            const user = auth.currentUser;
            if (!user) {
                showConfirmationModal('Error: Usuario no autenticado');
                return;
            }

            const btn = saveProfileSettingsButton;
            btn.disabled = true;
            btn.textContent = 'Guardando...';

            try {
                // Obtener valores de todos los campos
                const profileData = {
                    username: document.getElementById('profileUsernameInput')?.value.trim() || '',
                    aboutMe: document.getElementById('aboutMeContentInput')?.value.trim() || '',
                    interests: document.getElementById('interestsContentInput')?.value.trim() || '',
                    customContent: document.getElementById('customContentInput')?.value.trim() || '',
                    
                    // Configuraciones de visibilidad
                    showAboutMe: document.getElementById('showAboutMeCheckbox')?.checked || false,
                    showInterests: document.getElementById('showInterestsCheckbox')?.checked || false,
                    showMyPhotos: document.getElementById('showMyPhotosCheckbox')?.checked || false,
                    showMyMusic: document.getElementById('showMyMusicCheckbox')?.checked || false,
                    showCustomContent: document.getElementById('showCustomContentCheckbox')?.checked || false,
                    
                    // Colores personalizados
                    primaryTextColor: document.getElementById('profilePrimaryTextColorInput')?.value || '#ff3058',
                    secondaryTextColor: document.getElementById('profileSecondaryTextColorInput')?.value || '#7d3490',
                    cardBackgroundColor: document.getElementById('profileCardBackgroundColorInput')?.value || 'rgba(74, 26, 85, 0.4)',
                    borderColor: document.getElementById('profileBorderColorInput')?.value || '#ff3058',
                    
                    // Enlaces de música y redes sociales
                    myMusicSpotifyUrl: document.getElementById('myMusicSpotifyInput')?.value.trim() || '',
                    myMusicYoutubeUrl: document.getElementById('myMusicYoutubeInput')?.value.trim() || '',
                    myMusicSoundcloudUrl: document.getElementById('myMusicSoundcloudInput')?.value.trim() || '',
                    whatsappUrl: document.getElementById('whatsappUrlInput')?.value.trim() || '',
                    instagramUrl: document.getElementById('instagramUrlInput')?.value.trim() || '',
                    facebookUrl: document.getElementById('facebookUrlInput')?.value.trim() || '',
                    twitterUrl: document.getElementById('twitterUrlInput')?.value.trim() || '',
                    
                    updatedAt: new Date()
                };

                // Validaciones básicas
                if (!profileData.username) {
                    showConfirmationModal('El nombre de usuario es obligatorio');
                    return;
                }

                const userRef = doc(db, 'users', user.uid);
                await setDoc(userRef, profileData, { merge: true });
                
                // Invalidar caché para forzar recarga
                profileCache.invalidate(`profile_${user.uid}`);
                profileCache.invalidate(`posts_${user.uid}`);
                
                showConfirmationModal('Perfil actualizado con éxito!');
                document.getElementById('profileEditModal').classList.add('hidden');
                
                // Recargar el perfil con datos frescos
                await cargarYMostrarDatosPerfil(user.uid, true);
                
            } catch (error) {
                console.error('Error al guardar el perfil:', error);
                showConfirmationModal('Error al guardar los cambios: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Guardar Cambios';
            }
        });

        // Funcionalidades adicionales faltantes
        
        // Botón de configuración
        const settingsButton = document.getElementById('settingsButton');
        if (settingsButton) {
            settingsButton.addEventListener('click', () => {
                showConfirmationModal('Configuración en desarrollo. Próximamente disponible.');
            });
        }

        // Botón de chat flotante
        const chatButton = document.getElementById('chatButton');
        if (chatButton) {
            chatButton.addEventListener('click', () => {
                showConfirmationModal('Chat en desarrollo. Próximamente disponible.');
            });
        }

        // --- Lógica de Menús Laterales y Navegación de Footer ---
        const navMenuButton = document.getElementById('navMenu');
        const sideMenu = document.getElementById('sideMenu');
        const closeSideMenuBtn = document.getElementById('closeSideMenuBtn');
        const navRewardsButton = document.getElementById('navRewards');
        const rewardsSideMenu = document.getElementById('rewardsSideMenu');
        const closeRewardsSideMenuBtn = document.getElementById('closeRewardsSideMenuBtn');
        const sideMenuNavContent = document.getElementById('sideMenuNavContent');
        const sideMenuMainTitle = document.getElementById('sideMenuMainTitle');

        // Modales de información
        const infoModal = document.getElementById('infoModal');
        const infoModalTitle = document.getElementById('infoModalTitle');
        const infoModalIntroText = document.getElementById('infoModalIntroText');
        const infoModalBodyContent = document.getElementById('infoModalBodyContent');
        const closeInfoModalBtn = document.getElementById('closeInfoModalBtn');

        // Funciones para abrir/cerrar menús laterales
        if (navMenuButton) {
            navMenuButton.addEventListener('click', (e) => {
                e.preventDefault();
                sideMenu.classList.add('open');
            });
        }
        if (closeSideMenuBtn) {
            closeSideMenuBtn.addEventListener('click', () => {
                sideMenu.classList.remove('open');
                // Restaurar el menú principal si se estaba viendo otra cosa
                sideMenuNavContent.classList.remove('hidden');
                sideMenuMainTitle.textContent = 'Menú Principal';
                if (document.getElementById('sideMenuBackButton')) {
                    document.getElementById('sideMenuBackButton').remove();
                }
                infoModalBodyContent.innerHTML = ''; // Limpiar contenido del modal de info
            });
        }
        if (navRewardsButton) {
            navRewardsButton.addEventListener('click', (e) => {
                e.preventDefault();
                rewardsSideMenu.classList.add('open');
            });
        }
        if (closeRewardsSideMenuBtn) {
            closeRewardsSideMenuBtn.addEventListener('click', () => {
                rewardsSideMenu.classList.remove('open');
            });
        }

        // Función para mostrar modal de información
        function showInfoModal(title, introText, bodyContent) {
            infoModalTitle.textContent = title;
            infoModalIntroText.textContent = introText;
            infoModalBodyContent.innerHTML = bodyContent;
            infoModal.classList.remove('hidden');
        }

        if (closeInfoModalBtn) {
            closeInfoModalBtn.addEventListener('click', () => {
                infoModal.classList.add('hidden');
            });
        }

        // --- Lógica para los elementos del menú lateral ---
        const sideMenuMission = document.getElementById('sideMenuMission');
        const sideMenuWhoAreWe = document.getElementById('sideMenuWhoAreWe');
        const sideMenuPrices = document.getElementById('sideMenuPrices');
        const sideMenuSupport = document.getElementById('sideMenuSupport');
        const sideMenuDevelopers = document.getElementById('sideMenuDevelopers');
        const sideMenuLogout = document.getElementById('sideMenuLogout');

        if (sideMenuMission) {
            sideMenuMission.addEventListener('click', (e) => {
                e.preventDefault();
                showInfoModal(
                    "Nuestra Misión",
                    "En THE RED, creemos en el poder de la creatividad y la conexión humana.",
                    `
                    <h3>Nuestra Visión</h3>
                    <p>Ser la plataforma líder que conecte a creadores de contenido con audiencias globales, fomentando un ecosistema donde la creatividad florezca sin límites.</p>
                    
                    <h3>Nuestros Valores</h3>
                    <ul>
                        <li><strong>Creatividad:</strong> Valoramos y promovemos la expresión artística en todas sus formas.</li>
                        <li><strong>Comunidad:</strong> Construimos espacios seguros donde las personas pueden conectar auténticamente.</li>
                        <li><strong>Innovación:</strong> Utilizamos tecnología de vanguardia para mejorar la experiencia del usuario.</li>
                        <li><strong>Inclusión:</strong> Celebramos la diversidad y damos la bienvenida a todas las voces.</li>
                    </ul>
                    
                    <p>Estamos aquí para empoderar a los creadores, conectar a las personas y construir un futuro digital más brillante.</p>
                    `
                );
                sideMenu.classList.remove('open');
            });
        }

        if (sideMenuWhoAreWe) {
            sideMenuWhoAreWe.addEventListener('click', (e) => {
                e.preventDefault();
                showInfoModal(
                    "Quiénes Somos",
                    "THE RED es más que una plataforma; somos una comunidad apasionada de creadores, innovadores y soñadores.",
                    `
                    <h3>Nuestro Equipo</h3>
                    <p>Somos un equipo diverso de desarrolladores, diseñadores, creadores de contenido y visionarios tecnológicos unidos por una pasión común: crear la mejor plataforma para la expresión creativa.</p>
                    
                    <h3>Nuestra Historia</h3>
                    <p>Comenzamos como un pequeño proyecto con grandes sueños, y gracias al apoyo de nuestra creciente comunidad, hemos evolucionado hasta convertirnos en lo que somos hoy. Cada paso que damos está impulsado por el deseo de ofrecer la mejor experiencia posible a nuestros usuarios.</p>
                    `
                );
                sideMenu.classList.remove('open');
            });
        }

        if (sideMenuPrices) {
            sideMenuPrices.addEventListener('click', (e) => {
                e.preventDefault();
                showInfoModal(
                    "Planes de Suscripción",
                    "Elige el plan que mejor se adapte a tus necesidades creativas.",
                    `
                    <div class="price-plan-card">
                        <h3>Plan Básico</h3>
                        <div class="price">Gratis</div>
                        <ul>
                            <li><i class="fas fa-check"></i> Hasta 5 publicaciones por mes</li>
                            <li><i class="fas fa-check"></i> Acceso a la comunidad</li>
                            <li><i class="fas fa-check"></i> Soporte básico</li>
                        </ul>
                        <button class="subscribe-button" data-plan="basic">Comenzar Gratis</button>
                    </div>
                    
                    <div class="price-plan-card">
                        <h3>Plan Pro</h3>
                        <div class="price">$9.99 <small>/mes</small></div>
                        <ul>
                            <li><i class="fas fa-check"></i> Publicaciones ilimitadas</li>
                            <li><i class="fas fa-check"></i> Análisis avanzados</li>
                            <li><i class="fas fa-check"></i> Soporte prioritario</li>
                            <li><i class="fas fa-check"></i> Herramientas de edición premium</li>
                        </ul>
                        <button class="subscribe-button" data-plan="pro">Suscribirse</button>
                    </div>
                    `
                );
                sideMenu.classList.remove('open');

                // Añadir listeners a los botones de suscripción
                document.querySelectorAll('.subscribe-button').forEach(button => {
                    button.addEventListener('click', function() {
                        const plan = this.getAttribute('data-plan');
                        showConfirmationModal(`Suscripción al plan ${plan} en desarrollo.`);
                    });
                });
            });
        }

        if (sideMenuSupport) {
            sideMenuSupport.addEventListener('click', (e) => {
                e.preventDefault();
                showInfoModal(
                    "Soporte y Ayuda",
                    "Estamos aquí para ayudarte. Encuentra respuestas a tus preguntas o contacta con nuestro equipo de soporte.",
                    `
                    <h3>Preguntas Frecuentes</h3>
                    <h4>¿Cómo puedo crear una cuenta?</h4>
                    <p>Simplemente haz clic en "Registrarse" y sigue las instrucciones.</p>
                    
                    <h4>¿Puedo cambiar mi plan en cualquier momento?</h4>
                    <p>Sí, puedes actualizar o degradar tu plan desde la configuración de tu cuenta.</p>
                    
                    <h3>Contacto</h3>
                    <p>Si necesitas ayuda adicional, puedes contactarnos en: <strong>soporte@thered.com</strong></p>
                    <p>Nos esforzamos por responder a todas las consultas en un plazo de 24 horas.</p>
                    `
                );
                sideMenu.classList.remove('open');
            });
        }

        if (sideMenuDevelopers) {
            sideMenuDevelopers.addEventListener('click', (e) => {
                e.preventDefault();
                showInfoModal(
                    "Para Desarrolladores",
                    "Únete a nuestra comunidad de desarrolladores y ayuda a construir el futuro de THE RED.",
                    `
                    <h3>API de THE RED</h3>
                    <p>Accede a nuestra API RESTful para integrar THE RED en tus aplicaciones.</p>
                    
                    <h3>SDK y Herramientas</h3>
                    <p>Descarga nuestros SDKs para JavaScript, Python, y más.</p>
                    
                    <h3>Documentación</h3>
                    <p>Encuentra guías completas, ejemplos de código y referencias de API en nuestro portal de desarrolladores.</p>
                    
                    <p>¡Esperamos ver las increíbles creaciones que construirás con The Red!</p>
                    `
                );
                sideMenu.classList.remove('open');
            });
        }

        if (sideMenuLogout) {
            sideMenuLogout.addEventListener('click', async (e) => {
                e.preventDefault();
                try {
                    showConfirmationModal("Cerrando sesión...");
                    // Aquí iría la lógica de cerrar sesión con Firebase
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 1500);
                } catch (error) {
                    console.error("Error al cerrar sesión:", error);
                    showConfirmationModal("Error al cerrar sesión.");
                }
                sideMenu.classList.remove('open');
            });
        }

        // Navegación del footer
        const footerNavItems = document.querySelectorAll('.footer-nav .nav-item');
        footerNavItems.forEach(item => {
            item.addEventListener('click', (e) => {
                if (item.id === 'navMenu' || item.id === 'navRewards') {
                    // Ya manejado arriba
                    return;
                }
                e.preventDefault();
                const href = item.getAttribute('href');
                if (href && href !== '#') {
                    window.location.href = href;
                }
            });
        });

        // Función showImageModal faltante pero necesaria para la funcionalidad
        function showImageModal(imageUrl, username) {
            // Eliminar modales existentes para no apilarlos
            document.querySelectorAll('.modal-overlay.image-modal').forEach(modal => modal.remove());

            const modal = document.createElement('div');
            modal.className = 'modal-overlay image-modal'; // Añadir clase para identificarlo
            modal.style.display = 'flex'; // Asegurarse que es visible
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 90vw; max-height: 90vh; padding: 20px; animation: fadeInScale 0.3s ease-out;">
                    <button style="position: absolute; top: 10px; right: 15px; font-size: 2em; background: none; border: none; color: white; cursor: pointer;" onclick="this.closest('.modal-overlay').remove()">×</button>
                    <h3 style="color: var(--light-purple); margin-bottom: 15px;">Foto de ${username}</h3>
                    <img src="${imageUrl}" alt="Imagen expandida" style="max-width: 100%; max-height: 70vh; object-fit: contain; border-radius: 10px;">
                    <div class="modal-actions" style="margin-top: 20px;">
                        <button class="modal-button" onclick="this.closest('.modal-overlay').remove()">Cerrar</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // Cerrar con click fuera del contenido del modal
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }

        // Prevenir comportamientos no deseados
        document.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            showConfirmationModal('Clic derecho deshabilitado');
        });

        document.addEventListener('keydown', (e) => {
            if (e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key === 'I') || (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
                showConfirmationModal('Herramientas de desarrollador deshabilitadas');
            }
        });


    </script>
</body>
</html>

